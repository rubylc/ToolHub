<!doctype html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8" />
    <title>ToolHub</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
            width: 100%;
        }

        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            background: #0d1114;
            background: radial-gradient(circle at 85% 15%, #131c24 0%, #0d1114 50%);
            color: #e5e7eb;
            overflow: hidden;
            display: flex;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400" viewBox="0 0 800 800"><g fill="none" stroke="rgba(128,128,128,0.05)" stroke-width="1"><path d="M769 229L1037 260.9M927 880L731 737 520 660 309 538 40 599 295 764 126.5 879.5 40 599-197 493 102 382-31 229 126.5 79.5-69-63"/><path d="M-31 229L237 261 390 382 603 493 308.5 537.5 101.5 381.5M370 905L295 764"/><path d="M520 660L578 842 731 737 840 599 603 493 520 660 295 764 309 538 390 382 539 269 769 229 577.5 41.5 370 105 295 -36 126.5 79.5 237 261 102 382 40 599 -69 737 127 880"/><path d="M520-140L578.5 42.5 731-63M603 493L539 269 237 261 370 105M902 382L539 269M390 382L102 382"/><path d="M-222 42L126.5 79.5 370 105 539 269 577.5 41.5 927 80 769 229 902 382 603 493 731 737M295-36L577.5 41.5M578 842L295 764M40-201L127 80M102 382L-261 269"/></g></svg>') 0 0/cover no-repeat;
            opacity: 0.2;
            z-index: -1;
        }

        #app {
            flex: 1;
            position: relative;
        }

        header.topbar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 46px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(22, 27, 32, 0.8);
            border-bottom: 1px solid rgba(31, 38, 44, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 0 14px;
            z-index: 20;
            box-shadow: 0 1px 10px rgba(0, 0, 0, 0.1);
        }

        .brand {
            font-size: 14px;
            font-weight: 600;
            letter-spacing: .5px;
            color: #fff;
        }

        .nav-list {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
            overflow-x: auto;
            scrollbar-width: thin;
            padding-left: 14px;
            padding-top: 2px;
            padding-bottom: 2px;
        }

        /* 全局滚动条样式 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 30, 0.5);
            border-radius: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(55, 70, 85, 0.6);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(70, 90, 110, 0.8);
        }

        /* 导航栏特定滚动条 */
        .nav-list::-webkit-scrollbar {
            height: 4px;
        }

        .nav-list::-webkit-scrollbar-thumb {
            background: rgba(55, 70, 85, 0.5);
            border-radius: 4px;
        }

        .item {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            font-size: 13px;
            line-height: 1;
            border-radius: 8px;
            background: rgba(45, 55, 65, 0.5);
            color: #b4bdc6;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            white-space: nowrap;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .item:hover {
            background: rgba(55, 65, 75, 0.65);
            color: #fff;
            transform: translateY(-1px);
        }

        .item.active {
            background: rgba(59, 130, 246, 0.85);
            color: #fff;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);
        }

        .item span.icon {
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            background: #334155;
            border-radius: 4px;
        }

        .ver {
            font-size: 11px;
            color: #56626a;
            margin-right: 4px;
        }

        .settings-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: 8px;
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 8px;
            border: none;
            background: rgba(45, 55, 65, 0.5);
            color: #b4bdc6;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-right: 10px;
            position: relative;
            z-index: 50;
            /* 确保按钮在最上层，高于设置面板 */
        }

        .settings-btn:hover {
            background: rgba(55, 65, 75, 0.65);
            color: #fff;
            transform: translateY(-1px);
        }

        /* 内容区域布局 */
        main {
            position: absolute;
            top: 46px;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0d1114 0%, #111a20 50%, #0e1216 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            overflow: hidden;
            padding: 10px;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* 内容展示区域 */
        .content-container {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            display: none;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .content-container.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        main {
            position: absolute;
            top: 46px;
            left: 0;
            right: 0;
            bottom: 0;
        }

        iframe.site-frame,
        webview.site-view,
        div.time-view,
        div.pwd-view,
        div.text-view,
        div.calc-view,
        div.dns-view,
        div.json-view,
        div.codec-view,
        div.crypto-view,
        div.currency-view,
        div.curl-view {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            border: 0;
            display: none;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: opacity 0.3s ease;
            /* 只对opacity做过渡，避免布局变化导致抖动 */
            will-change: opacity;
            /* 提示浏览器做优化 */
        }

        iframe.site-frame.active,
        webview.site-view.active,
        div.time-view.active,
        div.pwd-view.active,
        div.text-view.active,
        div.calc-view.active,
        div.dns-view.active,
        div.json-view.active,
        div.codec-view.active,
        div.crypto-view.active,
        div.currency-view.active,
        div.curl-view.active {
            display: flex;
            opacity: 1;
            /* 确保活动视图显示 */
        }

        .status {
            position: absolute;
            top: 8px;
            right: 10px;
            padding: 4px 10px;
            font-size: 12px;
            background: #11181d;
            border: 1px solid #223038;
            border-radius: 20px;
            color: #cfd5d9;
            display: none;
            align-items: center;
            gap: 6px;
            pointer-events: none;
        }

        .status.error {
            background: rgba(190, 30, 55, .85);
            border-color: #fca5a5;
            color: #fff;
        }

        /* 时间视图布局与样式 - 酷炫版本 */
        div.time-view {
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: linear-gradient(135deg, #0d1114 0%, #1a1f2e 50%, #0d1114 100%);
            min-height: 100vh;
            position: relative;
            overflow: hidden;
            padding-bottom: 3vh;
            /* 减少底部间距 */
            padding-top: 3vh;
            /* 添加顶部间距，让内容整体上移 */
        }

        /* 时间工具背景动画粒子效果 */
        div.time-view::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 20% 80%, rgba(120, 120, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 120, 120, 0.1) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite alternate;
            pointer-events: none;
        }

        div.time-view::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 60% 30%, rgba(0, 212, 255, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 30% 70%, rgba(255, 107, 107, 0.08) 0%, transparent 40%);
            animation: backgroundShift 25s ease-in-out infinite alternate-reverse;
            pointer-events: none;
        }

        .time-wrap {
            width: min(980px, 96%);
            margin: 0 auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        .time-big {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 46px;
            line-height: 1.2;
            letter-spacing: 0.6px;
            text-shadow: 0 2px 20px rgba(0, 0, 0, .25);
            margin-top: 10vh;
            /* 减少顶部间距，整体向上移动一点 */
        }

        /* Monokai风格的彩色时间 */
        .time-big .year {
            color: #F92672;
        }

        .time-big .month {
            color: #66D9EF;
        }

        .time-big .day {
            color: #A6E22E;
        }

        .time-big .hour {
            color: #FD971F;
        }

        .time-big .minute {
            color: #AE81FF;
        }

        .time-big .second {
            color: #E6DB74;
        }

        .time-big .divider {
            color: #75715E;
        }

        .time-sub {
            margin-top: 12px;
            color: #93a6b2;
            font-size: 15px;
            line-height: 1.8;
        }

        .time-grid {
            margin: 25px auto 0;
            /* 减少顶部间距，整体上移 */
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 20px;
            max-width: 900px;
        }

        .stamp-box {
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(145deg, #1a2332 0%, #0f1419 100%);
            border: 1px solid #2a3440;
            border-radius: 20px;
            padding: 18px 20px;
            transition: all 0.3s ease;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.6s ease-out;
        }

        .stamp-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .stamp-box:hover::before {
            left: 100%;
        }

        .stamp-box:hover {
            transform: translateY(-2px);
            box-shadow:
                0 12px 40px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .stamp-box .label {
            color: #00d4ff;
            font-size: 15px;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
        }

        .stamp-box .value {
            margin-left: auto;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            color: #00d4ff;
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(145deg, #0a0f13 0%, #1a1f2a 100%);
            border: 2px solid #223038;
            border-radius: 12px;
            padding: 8px 16px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
            box-shadow:
                inset 0 2px 10px rgba(0, 0, 0, 0.3),
                0 0 0 rgba(0, 212, 255, 0);
        }

        .stamp-box .value:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow:
                inset 0 2px 10px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 212, 255, 0.4);
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
        }

        .stamp-box .copy-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(145deg, #4ecdc4 0%, #44a08d 100%);
            color: #ffffff;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            box-shadow:
                0 4px 15px rgba(78, 205, 196, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .stamp-box .copy-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .stamp-box .copy-btn:hover::before {
            left: 100%;
        }

        .stamp-box .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow:
                0 8px 25px rgba(78, 205, 196, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        /* Toast 提示 */
        #toast {
            position: absolute;
            left: 50%;
            bottom: 20px;
            transform: translateX(-50%) translateY(10px);
            background: #11181d;
            color: #cfd5d9;
            border: 1px solid #223038;
            border-radius: 10px;
            padding: 8px 12px;
            font-size: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, .3);
            opacity: 0;
            transition: all .2s ease;
            z-index: 50;
            pointer-events: none;
        }

        #toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .stamp-box.full {
            grid-column: 1 / -1;
        }

        .stamp-box input {
            flex: 1;
            min-width: 120px;
            background: linear-gradient(145deg, #0a0f13 0%, #1a1f2a 100%);
            color: #00d4ff;
            border: 2px solid #223038;
            border-radius: 10px;
            padding: 8px 12px;
            font-size: 14px;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .stamp-box input:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow:
                inset 0 2px 6px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(0, 212, 255, 0.4);
            text-shadow: 0 0 12px rgba(0, 212, 255, 0.5);
        }

        #dtRow input {
            flex: 0 0 auto;
            min-width: 0;
            width: 80px;
            text-align: center;
            /* 移除输入框的加减操作按钮 */
            appearance: textfield;
        }

        #dtRow input::-webkit-outer-spin-button,
        #dtRow input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            appearance: none;
            margin: 0;
        }

        #dtRow input+input {
            margin-left: 6px;
        }

        /* 密码生成器布局与样式 - 酷炫版本 */
        div.pwd-view {
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: linear-gradient(135deg, #0d1114 0%, #1a1f2e 50%, #0d1114 100%);
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* 背景动画粒子效果 */
        div.pwd-view::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 20% 80%, rgba(120, 120, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 120, 120, 0.1) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite alternate;
            pointer-events: none;
        }

        div.pwd-view::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 60% 30%, rgba(0, 212, 255, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 30% 70%, rgba(255, 107, 107, 0.08) 0%, transparent 40%);
            animation: backgroundShift 25s ease-in-out infinite alternate-reverse;
            pointer-events: none;
        }

        @keyframes backgroundShift {
            0% {
                transform: translateX(-10px) translateY(-10px);
            }

            100% {
                transform: translateX(10px) translateY(10px);
            }
        }

        .pwd-wrap {
            width: min(980px, 96%);
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* 标题已移除 */
        .pwd-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 12px;
        }

        .pwd-card {
            background: linear-gradient(145deg, #1a2332 0%, #0f1419 100%);
            border: 1px solid #2a3440;
            border-radius: 20px;
            padding: 20px 24px;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pwd-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .pwd-card:hover::before {
            left: 100%;
        }

        .pwd-card:hover {
            transform: translateY(-2px);
            box-shadow:
                0 12px 40px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .pwd-output {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .pwd-output input {
            flex: 1;
            background: linear-gradient(145deg, #0a0f13 0%, #1a1f2a 100%);
            color: #00d4ff;
            border: 2px solid #223038;
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 18px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            letter-spacing: 1px;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
            box-shadow:
                inset 0 2px 10px rgba(0, 0, 0, 0.3),
                0 0 0 rgba(0, 212, 255, 0);
        }

        .pwd-output input:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow:
                inset 0 2px 10px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 212, 255, 0.4);
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
        }

        .pwd-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(145deg, #ff6b6b 0%, #ff5252 100%);
            color: #ffffff;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            box-shadow:
                0 4px 15px rgba(255, 107, 107, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .pwd-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .pwd-btn:hover::before {
            left: 100%;
        }

        .pwd-btn:hover {
            transform: translateY(-2px);
            box-shadow:
                0 8px 25px rgba(255, 107, 107, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .pwd-btn:active {
            transform: translateY(0);
        }

        .pwd-btn#pwdCopy {
            background: linear-gradient(145deg, #4ecdc4 0%, #44a08d 100%);
            box-shadow:
                0 4px 15px rgba(78, 205, 196, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .pwd-btn#pwdCopy:hover {
            box-shadow:
                0 8px 25px rgba(78, 205, 196, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .pwd-small {
            font-size: 13px;
            color: #00d4ff;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.4);
        }

        .pwd-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .pwd-grid .pwd-card {
            animation: slideInUp 0.6s ease-out 0.2s both;
        }

        .pwd-meter {
            height: 12px;
            background: linear-gradient(90deg, #192129 0%, #0f1419 100%);
            border: 2px solid #223038;
            border-radius: 999px;
            overflow: hidden;
            position: relative;
            box-shadow:
                inset 0 2px 8px rgba(0, 0, 0, 0.4),
                0 0 0 rgba(34, 197, 94, 0);
            transition: box-shadow 0.3s ease;
        }

        .pwd-meter>div {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #22c55e);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.6);
        }

        .pwd-meter>div::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes glow {
            0% {
                box-shadow:
                    inset 0 2px 10px rgba(0, 0, 0, 0.3),
                    0 0 20px rgba(0, 212, 255, 0.4);
            }

            50% {
                box-shadow:
                    inset 0 2px 10px rgba(0, 0, 0, 0.3),
                    0 0 30px rgba(0, 212, 255, 0.8);
            }

            100% {
                box-shadow:
                    inset 0 2px 10px rgba(0, 0, 0, 0.3),
                    0 0 20px rgba(0, 212, 255, 0.4);
            }
        }

        .pwd-kv {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 8px 0;
        }

        .pwd-kv label {
            min-width: 90px;
            color: #00d4ff;
            font-size: 15px;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
        }

        .pwd-kv input[type="number"] {
            width: 90px;
            background: linear-gradient(145deg, #0a0f13 0%, #1a1f2a 100%);
            color: #00d4ff;
            border: 2px solid #223038;
            border-radius: 10px;
            padding: 8px 12px;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .pwd-kv input[type="number"]:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow:
                inset 0 2px 6px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(0, 212, 255, 0.4);
        }

        .pwd-kv input[type="checkbox"] {
            transform: scale(1.3) translateY(1px);
            accent-color: #00d4ff;
        }

        .pwd-kv .range {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pwd-kv input[type="range"] {
            flex: 1;
            height: 8px;
            background: linear-gradient(90deg, #192129 0%, #0f1419 100%);
            border-radius: 999px;
            outline: none;
            transition: all 0.3s ease;
        }

        .pwd-kv input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(145deg, #00d4ff 0%, #0099cc 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow:
                0 4px 12px rgba(0, 212, 255, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .pwd-kv input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow:
                0 6px 20px rgba(0, 212, 255, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        .pwd-note {
            color: #00d4ff;
            font-size: 13px;
            margin-top: 8px;
            text-shadow: 0 0 6px rgba(0, 212, 255, 0.3);
        }

        .pwd-opts {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .opt-chip {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            border: 2px solid #2a3440;
            border-radius: 25px;
            background: linear-gradient(145deg, #1a2332 0%, #0f1419 100%);
            color: #00d4ff;
            cursor: pointer;
            user-select: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow:
                0 4px 12px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .opt-chip::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .opt-chip:hover::before {
            left: 100%;
        }

        .opt-chip:hover {
            border-color: #00d4ff;
            transform: translateY(-2px);
            box-shadow:
                0 8px 20px rgba(0, 212, 255, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .opt-chip input {
            transform: scale(1.2);
            accent-color: #00d4ff;
        }

        .opt-chip input:checked+* {
            color: #ffffff;
            text-shadow: 0 0 12px rgba(0, 212, 255, 0.8);
        }

        /* 文本统计 - 酷炫版本 */
        div.text-view {
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: linear-gradient(135deg, #0d1114 0%, #1a1f2e 50%, #0d1114 100%);
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* 文本统计工具背景动画粒子效果 */
        div.text-view::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 20% 80%, rgba(120, 120, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 120, 120, 0.1) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite alternate;
            pointer-events: none;
        }

        div.text-view::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 60% 30%, rgba(0, 212, 255, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 30% 70%, rgba(255, 107, 107, 0.08) 0%, transparent 40%);
            animation: backgroundShift 25s ease-in-out infinite alternate-reverse;
            pointer-events: none;
        }

        .text-wrap {
            width: min(1100px, 96%);
            margin: 0 auto;
            display: flex;
            flex-direction: row;
            gap: 16px;
            align-items: stretch;
            position: relative;
            z-index: 1;
        }

        .text-left {
            flex: 1.4;
            display: flex;
        }

        .text-right {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .stat-header {
            font-size: 18px;
            font-weight: 700;
            color: #00d4ff;
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: linear-gradient(145deg, #1a2332 0%, #0f1419 100%);
            border: 1px solid #2a3440;
            border-radius: 16px;
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            animation: slideInRight 0.6s ease-out 0.2s both;
        }

        .text-area {
            width: 100%;
            height: 70vh;
            background: linear-gradient(145deg, #0a0f13 0%, #1a1f2a 100%);
            color: #00d4ff;
            border: 2px solid #223038;
            border-radius: 20px;
            padding: 20px 24px;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            font-weight: 500;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.2);
            transition: all 0.3s ease;
            box-shadow:
                inset 0 4px 15px rgba(0, 0, 0, 0.3),
                0 0 0 rgba(0, 212, 255, 0);
            animation: slideInLeft 0.6s ease-out;
        }

        .text-area:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow:
                inset 0 4px 15px rgba(0, 0, 0, 0.3),
                0 0 25px rgba(0, 212, 255, 0.4);
            text-shadow: 0 0 12px rgba(0, 212, 255, 0.4);
        }

        @keyframes slideInLeft {
            0% {
                opacity: 0;
                transform: translateX(-30px);
            }

            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .stat-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            animation: slideInRight 0.6s ease-out 0.4s both;
        }

        @keyframes slideInRight {
            0% {
                opacity: 0;
                transform: translateX(30px);
            }

            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(145deg, #1a2332 0%, #0f1419 100%);
            border: 1px solid #2a3440;
            border-radius: 16px;
            padding: 16px 20px;
            transition: all 0.3s ease;
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .stat-item:hover::before {
            left: 100%;
        }

        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow:
                0 10px 30px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .stat-item .label {
            color: #00d4ff;
            font-size: 14px;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
        }

        .stat-item .value {
            margin-left: auto;
            color: #ffffff;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-weight: 700;
            font-size: 16px;
            background: linear-gradient(145deg, #0a0f13 0%, #1a1f2a 100%);
            border: 1px solid #223038;
            border-radius: 10px;
            padding: 6px 12px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        /* 计算器 - 酷炫版本 */
        div.calc-view {
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: linear-gradient(135deg, #0d1114 0%, #1a1f2e 50%, #0d1114 100%);
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* 计算器背景动画粒子效果 */
        div.calc-view::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 20% 80%, rgba(120, 120, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 120, 120, 0.1) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite alternate;
            pointer-events: none;
        }

        div.calc-view::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 60% 30%, rgba(0, 212, 255, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 30% 70%, rgba(255, 107, 107, 0.08) 0%, transparent 40%);
            animation: backgroundShift 25s ease-in-out infinite alternate-reverse;
            pointer-events: none;
        }

        .calc-wrap {
            width: min(580px, 90%);
            /* 缩小宽度从720px到580px */
            margin: 4vh auto 0;
            /* 向上移动，从8vh减少到4vh */
            padding: 32px 28px;
            /* 缩小内边距从42px 36px到32px 28px */
            background: linear-gradient(145deg, #1a2332 0%, #0f1419 100%);
            border-radius: 32px;
            /* 缩小圆角从42px到32px */
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 8px 30px rgba(0, 0, 0, 0.4),
                inset 0 2px 4px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid #2a3440;
            position: relative;
            z-index: 1;
            animation: slideInUp 0.8s ease-out;
            overflow: hidden;
        }

        /* 添加机身质感 */
        .calc-wrap::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
            border-radius: 36px 36px 0 0;
            z-index: 1;
        }

        .calc-display {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            align-items: center;
            margin-top: 0;
            margin-bottom: 24px;
            border-radius: 20px;
            box-shadow:
                inset 0 3px 7px rgba(0, 0, 0, 0.3),
                inset 0 1px 3px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            background: linear-gradient(145deg, #0a0f13 0%, #1a1f2a 100%);
            padding: 6px;
            border: 2px solid #223038;
        }

        .calc-input {
            width: 100%;
            background: linear-gradient(145deg, #0a0f13 0%, #1a1f2a 100%);
            color: #00d4ff;
            border: 2px solid #223038;
            border-radius: 15px;
            padding: 14px 18px;
            font-size: 22px;
            /* 缩小字体从26px到22px */
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-weight: 600;
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
            box-shadow:
                inset 0 3px 8px rgba(0, 0, 0, 0.3),
                0 0 0 rgba(0, 212, 255, 0);
            transition: all 0.3s ease;
            height: 60px;
            /* 缩小高度从76px到60px */
        }

        .calc-input:focus {
            border-color: #00d4ff;
            box-shadow:
                inset 0 3px 8px rgba(0, 0, 0, 0.3),
                0 0 25px rgba(0, 212, 255, 0.5);
            outline: none;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.6);
        }

        /* 结果展示：无边框盒子，右对齐大号数字 + 细分隔线 */
        .calc-result {
            position: relative;
            margin: 0 0 24px;
            padding: 0 6px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            color: #ff6b6b;
            font-size: 42px;
            /* 缩小字体从52px到42px */
            font-weight: 800;
            text-align: right;
            line-height: 1.1;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
            transition: all 0.3s ease;
            height: 72px;
            /* 增加高度从52px到72px */
            min-height: 72px;
            /* 确保最小高度 */
            display: flex;
            align-items: center;
            /* 改为居中对齐，避免文字超出 */
            justify-content: flex-end;
            /* 右对齐 */
            background: linear-gradient(145deg, #0a0f13 0%, #1a1f2a 100%);
            border-radius: 14px;
            border: 2px solid #223038;
            padding: 16px 20px;
            /* 增加内边距 */
            box-shadow:
                inset 0 2px 8px rgba(0, 0, 0, 0.3),
                0 0 0 rgba(255, 107, 107, 0);
        }

        .calc-result::after {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            bottom: -10px;
            height: 2px;
            background: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(245, 158, 11, .55), rgba(0, 0, 0, 0));
        }

        .calc-result.error {
            color: #fca5a5;
        }

        .calc-result.pop {
            animation: calcPop .18s ease-out;
        }

        @keyframes calcPop {
            0% {
                transform: scale(.98);
                opacity: .85;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .calc-grid {
            margin-top: 24px;
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 16px;
            /* 缩小间距从20px到16px */
            max-width: 420px;
            /* 缩小最大宽度从540px到420px */
            margin-left: auto;
            margin-right: auto;
        }

        .btn {
            padding: 16px 0;
            /* 缩小内边距从20px到16px */
            text-align: center;
            border: 2px solid #2a3440;
            border-radius: 22px;
            /* 缩小圆角从28px到22px */
            background: linear-gradient(145deg, #1a2332 0%, #0f1419 100%);
            color: #ffffff;
            cursor: pointer;
            user-select: none;
            font-size: 22px;
            /* 缩小字体从28px到22px */
            font-weight: 600;
            /* 增加字体粗细 */
            transition: all 0.3s ease;
            /* 更平滑的过渡效果 */
            box-shadow:
                0 6px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.1);
            /* 强化立体感 */
            position: relative;
            overflow: hidden;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(2px) scale(.97);
            box-shadow:
                0 2px 8px rgba(0, 0, 0, 0.3),
                inset 0 2px 8px rgba(0, 0, 0, 0.3);
            /* 按下时减小阴影且添加内阴影 */
        }

        .btn:hover {
            transform: translateY(-2px);
            border-color: #00d4ff;
            box-shadow:
                0 10px 25px rgba(0, 0, 0, 0.4),
                inset 0 1px 2px rgba(255, 255, 255, 0.2),
                0 0 20px rgba(0, 212, 255, 0.3);
            /* 悬停时增加阴影和发光效果 */
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        }

        .btn.num {
            background: linear-gradient(145deg, #2563eb 0%, #1d4ed8 100%);
            border-color: #3b82f6;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(37, 99, 235, 0.5);
        }

        .btn.num:hover {
            background: linear-gradient(145deg, #3b82f6 0%, #2563eb 100%);
            border-color: #60a5fa;
            box-shadow:
                0 10px 25px rgba(0, 0, 0, 0.4),
                inset 0 1px 2px rgba(255, 255, 255, 0.2),
                0 0 25px rgba(37, 99, 235, 0.5);
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        }

        .btn.op {
            background: linear-gradient(145deg, #f59e0b 0%, #d97706 100%);
            border-color: #f59e0b;
            color: #ffffff;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }

        .btn.op:hover {
            background: linear-gradient(145deg, #fbbf24 0%, #f59e0b 100%);
            border-color: #fcd34d;
            box-shadow:
                0 10px 25px rgba(0, 0, 0, 0.4),
                inset 0 1px 2px rgba(255, 255, 255, 0.2),
                0 0 25px rgba(245, 158, 11, 0.5);
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        }

        /* 添加按钮按下和悬停的波纹效果 */
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
            pointer-events: none;
            opacity: 0;
        }

        .btn:hover::after {
            width: 120%;
            height: 120%;
            opacity: 1;
        }

        /* 移除重复的op悬停样式 */

        .btn.ctrl {
            background: linear-gradient(145deg, #ef4444 0%, #dc2626 100%);
            border-color: #ef4444;
            color: #ffffff;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .btn.ctrl:hover {
            background: linear-gradient(145deg, #f87171 0%, #ef4444 100%);
            border-color: #fca5a5;
            box-shadow:
                0 10px 25px rgba(0, 0, 0, 0.4),
                inset 0 1px 2px rgba(255, 255, 255, 0.2),
                0 0 25px rgba(239, 68, 68, 0.5);
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        }

        /* AC按钮特殊样式 */
        .btn.ctrl[data-act="ac"] {
            background: linear-gradient(145deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .btn.ctrl[data-act="ac"]:hover {
            background: linear-gradient(145deg, #34d399 0%, #10b981 100%);
            border-color: #6ee7b7;
            box-shadow:
                0 10px 25px rgba(0, 0, 0, 0.4),
                inset 0 1px 2px rgba(255, 255, 255, 0.2),
                0 0 25px rgba(16, 185, 129, 0.5);
        }

        .calc-row {
            display: flex;
            align-items: stretch;
            justify-content: center;
            gap: 14px;
            margin-top: 18px;
        }

        /* 放大底部 AC/回退按钮 */
        .calc-row {
            max-width: 420px;
            /* 缩小最大宽度从540px到420px */
            margin: 16px auto 0;
            display: flex;
            gap: 16px;
            /* 缩小间距从20px到16px */
        }

        .calc-row .btn {
            flex: 1 1 0;
            height: 64px;
            /* 缩小高度从80px到64px */
            font-size: 24px;
            /* 缩小字体从30px到24px */
            border-radius: 22px;
            /* 保持和其他按钮一致的圆润感 */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.35), inset 0 1px 1px rgba(255, 255, 255, 0.1);
            /* 更强的阴影效果 */
        }

        /* DNS 解析工具 - 酷炫版本 */
        div.dns-view {
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: linear-gradient(135deg, #0d1114 0%, #1a1f2e 50%, #0d1114 100%);
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* DNS解析工具背景动画粒子效果 */
        div.dns-view::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 20% 80%, rgba(120, 120, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 120, 120, 0.1) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite alternate;
            pointer-events: none;
        }

        div.dns-view::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 60% 30%, rgba(0, 212, 255, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 30% 70%, rgba(255, 107, 107, 0.08) 0%, transparent 40%);
            animation: backgroundShift 25s ease-in-out infinite alternate-reverse;
            pointer-events: none;
        }

        .dns-wrap {
            width: min(1180px, 96%);
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .dns-split {
            display: flex;
            gap: 18px;
            align-items: stretch;
        }

        .dns-left {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
        }

        .dns-left::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, transparent, rgba(0, 212, 255, 0.3), transparent);
            z-index: 1;
        }

        .dns-right {
            flex: 1.2;
            min-width: 0;
        }

        .dns-form {
            display: grid;
            grid-template-columns: 1.6fr .5fr 1fr;
            gap: 10px;
            align-items: center;
        }

        .dns-input {
            width: 100%;
            background: linear-gradient(145deg, #0a0f13 0%, #1a1f2a 100%);
            color: #00d4ff;
            border: 2px solid #223038;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .dns-input:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow:
                inset 0 2px 6px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(0, 212, 255, 0.4);
            text-shadow: 0 0 12px rgba(0, 212, 255, 0.5);
        }

        .dns-select {
            width: 100%;
            background: linear-gradient(145deg, #0a0f13 0%, #1a1f2a 100%);
            color: #00d4ff;
            border: 2px solid #223038;
            border-radius: 12px;
            padding: 10px 12px;
            font-size: 13px;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
        }

        .dns-select:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
        }

        .dns-btn {
            padding: 12px 18px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(145deg, #4ecdc4 0%, #44a08d 100%);
            color: #ffffff;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            box-shadow:
                0 4px 15px rgba(78, 205, 196, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .dns-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .dns-btn:hover::before {
            left: 100%;
        }

        .dns-btn:hover {
            transform: translateY(-2px);
            box-shadow:
                0 8px 25px rgba(78, 205, 196, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .dns-chips {
            margin-top: 2px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 999px;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            color: #00d4ff;
            font-size: 12px;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
        }

        .chip:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: #00d4ff;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.2);
        }

        .chip input {
            transform: scale(1.05);
            accent-color: #00d4ff;
            filter: drop-shadow(0 0 4px rgba(0, 212, 255, 0.4));
        }

        .dns-grid {
            margin-top: 14px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }

        .dns-card {
            position: relative;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 14px;
            padding: 12px 12px;
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease backwards;
        }

        .dns-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .dns-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dns-card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .dns-card:nth-child(4) {
            animation-delay: 0.4s;
        }

        .dns-card:hover {
            border-color: #00d4ff;
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.2);
            transform: translateY(-2px);
        }

        .dns-card.full {
            grid-column: 1 / -1;
        }

        .dns-card h4 {
            font-size: 13px;
            color: #00d4ff;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .dns-copy {
            font-size: 12px;
            padding: 4px 8px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(5px);
            color: #00d4ff;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .dns-copy::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .dns-copy:hover::before {
            left: 100%;
        }

        .dns-copy:hover {
            background: rgba(0, 212, 255, 0.1);
            color: #ffffff;
            border-color: #00d4ff;
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
            transform: translateY(-1px);
        }

        /* 编解码工具 */
        div.codec-view {
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: linear-gradient(135deg, #0d1114 0%, #1a1f2e 50%, #0d1114 100%);
            position: relative;
            overflow: hidden;
        }

        div.codec-view::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 20%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 70%, rgba(0, 212, 255, 0.08) 0%, transparent 50%);
            animation: backgroundShift 25s ease-in-out infinite;
            z-index: 0;
        }

        .codec-wrap {
            width: min(1200px, 98%);
            margin: 0 auto;
            padding: 30px 20px;
            height: calc(100vh - 120px);
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        .codec-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
            padding-bottom: 15px;
            flex-shrink: 0;
            animation: slideInUp 0.6s ease backwards;
        }

        .codec-tab {
            padding: 12px 24px;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: #00d4ff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .codec-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .codec-tab:hover::before {
            left: 100%;
        }

        .codec-tab:hover {
            background: rgba(0, 212, 255, 0.1);
            color: #ffffff;
            border-color: #00d4ff;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
            transform: translateY(-2px);
        }

        .codec-tab.active {
            background: linear-gradient(135deg, #00d4ff, #0ea5e9);
            border-color: #00d4ff;
            color: #ffffff;
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .codec-panel {
            display: none;
            flex: 1;
            gap: 20px;
            position: relative;
        }

        .codec-panel.active {
            display: flex;
            animation: slideInUp 0.6s ease backwards;
            animation-delay: 0.2s;
        }

        .codec-panel::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 1px;
            height: 80%;
            background: linear-gradient(180deg, transparent, rgba(0, 212, 255, 0.3), transparent);
            transform: translateX(-50%) translateY(-50%);
            z-index: 1;
        }

        .codec-side {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: relative;
            z-index: 2;
        }

        .codec-label {
            font-size: 14px;
            font-weight: 500;
            color: #00d4ff;
            margin-bottom: 6px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .codec-textarea {
            flex: 1;
            min-height: 200px;
            padding: 12px;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: #00d4ff;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 13px;
            line-height: 1.4;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .codec-textarea:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
            background: rgba(15, 21, 26, 0.9);
        }

        .codec-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            animation: slideInUp 0.6s ease backwards;
            animation-delay: 0.3s;
        }

        .codec-btn {
            padding: 8px 16px;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: #00d4ff;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .codec-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .codec-btn:hover::before {
            left: 100%;
        }

        .codec-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            color: #ffffff;
            border-color: #00d4ff;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
            transform: translateY(-1px);
        }

        .codec-btn.primary {
            background: linear-gradient(135deg, #00d4ff, #0ea5e9);
            border-color: #00d4ff;
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
        }

        .codec-btn.primary:hover {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.5);
            transform: translateY(-2px);
        }

        .codec-error {
            color: #ff6b6b;
            font-size: 12px;
            margin-top: 6px;
            display: none;
            background: rgba(255, 107, 107, 0.1);
            padding: 6px 10px;
            border-radius: 6px;
            border-left: 3px solid #ff6b6b;
            text-shadow: 0 0 8px rgba(255, 107, 107, 0.3);
        }

        /* 加解密工具 */
        div.crypto-view {
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: linear-gradient(135deg, #0d1114 0%, #1a1f2e 50%, #0d1114 100%);
            position: relative;
            overflow: hidden;
        }

        div.crypto-view::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 20%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 70%, rgba(0, 212, 255, 0.08) 0%, transparent 50%);
            animation: backgroundShift 25s ease-in-out infinite;
            z-index: 0;
        }

        .crypto-wrap {
            width: min(1200px, 98%);
            margin: 0 auto;
            padding: 30px 20px;
            height: calc(100vh - 120px);
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        .crypto-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
            padding-bottom: 15px;
            flex-shrink: 0;
            animation: slideInUp 0.6s ease backwards;
        }

        .crypto-tab {
            padding: 12px 24px;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: #00d4ff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .crypto-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .crypto-tab:hover::before {
            left: 100%;
        }

        .crypto-tab:hover {
            background: rgba(0, 212, 255, 0.1);
            color: #ffffff;
            border-color: #00d4ff;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
            transform: translateY(-2px);
        }

        .crypto-tab.active {
            background: linear-gradient(135deg, #00d4ff, #0ea5e9);
            border-color: #00d4ff;
            color: #ffffff;
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .crypto-panel {
            display: none;
            flex: 1;
            gap: 20px;
            position: relative;
        }

        .crypto-panel.active {
            display: flex;
            animation: slideInUp 0.6s ease backwards;
            animation-delay: 0.2s;
        }

        .crypto-panel::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 1px;
            height: 80%;
            background: linear-gradient(180deg, transparent, rgba(0, 212, 255, 0.3), transparent);
            transform: translateX(-50%) translateY(-50%);
            z-index: 1;
        }

        .crypto-side {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: relative;
            z-index: 2;
        }

        .crypto-label {
            font-size: 14px;
            font-weight: 500;
            color: #00d4ff;
            margin-bottom: 6px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .crypto-textarea {
            flex: 1;
            min-height: 120px;
            padding: 12px;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: #00d4ff;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 13px;
            line-height: 1.4;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .crypto-textarea:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
            background: rgba(15, 21, 26, 0.9);
        }

        .crypto-input {
            padding: 8px 12px;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: #00d4ff;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .crypto-input:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
            background: rgba(15, 21, 26, 0.9);
        }

        .crypto-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            animation: slideInUp 0.6s ease backwards;
            animation-delay: 0.3s;
        }

        .crypto-btn {
            padding: 8px 16px;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: #00d4ff;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .crypto-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .crypto-btn:hover::before {
            left: 100%;
        }

        .crypto-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            color: #ffffff;
            border-color: #00d4ff;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
            transform: translateY(-1px);
        }

        .crypto-error {
            color: #ff6b6b;
            font-size: 12px;
            margin-top: 6px;
            display: none;
            background: rgba(255, 107, 107, 0.1);
            padding: 6px 10px;
            border-radius: 6px;
            border-left: 3px solid #ff6b6b;
            text-shadow: 0 0 8px rgba(255, 107, 107, 0.3);
        }

        .dns-list {
            font-size: 12px;
            line-height: 1.8;
            color: #00d4ff;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            white-space: pre-wrap;
            word-break: break-all;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
            background: rgba(0, 212, 255, 0.03);
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(0, 212, 255, 0.1);
        }

        .dns-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            color: #00d4ff;
            table-layout: fixed;
            background: rgba(0, 212, 255, 0.03);
            border-radius: 8px;
            overflow: hidden;
        }

        .dns-table th,
        .dns-table td {
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            padding: 6px 8px;
            text-align: left;
            vertical-align: top;
        }

        .dns-table th {
            color: #00d4ff;
            font-weight: 600;
            background: rgba(0, 212, 255, 0.1);
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.4);
        }

        .dns-table td:nth-child(4) {
            color: #00d4ff;
            word-break: break-all;
        }

        .dns-empty {
            color: rgba(0, 212, 255, 0.6);
            font-size: 12px;
            font-style: italic;
        }

        .dns-meta {
            margin-top: 8px;
            font-size: 11px;
            color: rgba(0, 212, 255, 0.7);
            background: rgba(0, 212, 255, 0.05);
            padding: 4px 8px;
            border-radius: 6px;
            border-left: 2px solid rgba(0, 212, 255, 0.3);
        }

        .dns-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }

        .dns-err {
            color: #ff6b6b;
            font-size: 12px;
            background: rgba(255, 107, 107, 0.1);
            padding: 6px 10px;
            border-radius: 6px;
            border-left: 3px solid #ff6b6b;
            text-shadow: 0 0 8px rgba(255, 107, 107, 0.3);
        }

        /* JSON 解析工具 */
        div.json-view {
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: linear-gradient(135deg, #0d1114 0%, #1a1f2e 50%, #0d1114 100%);
            position: relative;
            overflow: hidden;
        }

        div.json-view::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 20%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 70%, rgba(0, 212, 255, 0.08) 0%, transparent 50%);
            animation: backgroundShift 25s ease-in-out infinite;
            z-index: 0;
        }

        .json-wrap {
            width: min(1180px, 96%);
            margin: 0 auto;
            height: 100%;
            display: flex;
            position: relative;
            z-index: 1;
        }

        .json-split {
            display: flex;
            gap: 16px;
            align-items: stretch;
            flex: 1;
            min-height: 0;
        }

        .json-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 0;
            position: relative;
            animation: slideInLeft 0.6s ease backwards;
        }

        .json-left::after {
            content: '';
            position: absolute;
            top: 0;
            right: -8px;
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, transparent, rgba(0, 212, 255, 0.3), transparent);
            z-index: 1;
        }

        .json-right {
            flex: 1.2;
            display: flex;
            flex-direction: column;
            min-width: 0;
            min-height: 0;
            animation: slideInRight 0.6s ease backwards;
            animation-delay: 0.2s;
        }

        .json-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            animation: slideInUp 0.6s ease backwards;
            animation-delay: 0.1s;
        }

        .json-btn {
            padding: 8px 10px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            color: #00d4ff;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .json-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .json-btn:hover::before {
            left: 100%;
        }

        .json-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            color: #ffffff;
            border-color: #00d4ff;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
            transform: translateY(-1px);
        }

        .json-input {
            width: 100%;
            flex: 1;
            min-height: 0;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            color: #00d4ff;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 13px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            line-height: 1.6;
            overflow: auto;
            transition: all 0.3s ease;
        }

        .json-input:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
            background: rgba(15, 21, 26, 0.9);
        }

        .json-path {
            width: 100%;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            color: #00d4ff;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 8px 10px;
            font-size: 13px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            transition: all 0.3s ease;
        }

        .json-path:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
            background: rgba(15, 21, 26, 0.9);
        }

        .json-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .json-tab {
            padding: 6px 10px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 999px;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            color: #00d4ff;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .json-tab:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: #00d4ff;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.2);
        }

        .json-tab.active {
            background: linear-gradient(135deg, #00d4ff, #0ea5e9);
            border-color: #00d4ff;
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .json-panel {
            flex: 1;
            background: rgba(15, 21, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 10px 12px;
            min-height: 0;
            overflow: auto;
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease backwards;
        }

        .json-panel:hover {
            border-color: rgba(0, 212, 255, 0.5);
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.15);
        }

        .tree {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 13px;
            color: #00d4ff;
            line-height: 1.6;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
        }

        .tree .k {
            color: #00d4ff;
            font-weight: 600;
        }

        .tree .s {
            color: #10b981;
            text-shadow: 0 0 6px rgba(16, 185, 129, 0.4);
        }

        .tree .n {
            color: #f59e0b;
            text-shadow: 0 0 6px rgba(245, 158, 11, 0.4);
        }

        .tree .b {
            color: #8b5cf6;
            text-shadow: 0 0 6px rgba(139, 92, 246, 0.4);
        }

        .tree .null {
            color: #6b7280;
            font-style: italic;
        }

        .json-err {
            color: #ff6b6b;
            font-size: 12px;
            margin-top: 6px;
            background: rgba(255, 107, 107, 0.1);
            padding: 6px 10px;
            border-radius: 6px;
            border-left: 3px solid #ff6b6b;
            text-shadow: 0 0 8px rgba(255, 107, 107, 0.3);
        }

        /* 树形交互与层次样式 */
        .jtree {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 13px;
            color: #00d4ff;
            line-height: 1.5;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
        }

        .jt-node {
            position: relative;
            margin: 2px 0;
            transition: all 0.2s ease;
        }

        .jt-node:hover {
            background: rgba(0, 212, 255, 0.05);
            border-radius: 4px;
            padding: 1px 4px;
            margin: 2px -4px;
        }

        .jt-head {
            display: inline-flex;
            align-items: baseline;
            gap: 6px;
            cursor: pointer;
            user-select: none;
        }

        .jt-caret {
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 5px 0 5px 7px;
            border-color: transparent transparent transparent #00d4ff;
            display: inline-block;
            transform: rotate(90deg);
            transition: transform .15s ease;
            margin-right: 2px;
            filter: drop-shadow(0 0 3px rgba(0, 212, 255, 0.5));
        }

        .jt-leaf {
            width: 9px;
            display: inline-block;
        }

        .jt-key {
            color: #00d4ff;
            font-weight: 600;
        }

        .jt-sum {
            color: rgba(0, 212, 255, 0.7);
            font-size: 12px;
            opacity: .9;
        }

        .jt-children {
            margin-left: 14px;
            padding-left: 10px;
            border-left: 1px dotted rgba(0, 212, 255, 0.3);
        }

        .jt-node.collapsed>.jt-children {
            display: none;
        }

        .jt-node.collapsed>.jt-head .jt-caret {
            transform: rotate(0deg);
        }

        .jt-val.s {
            color: #10b981;
            text-shadow: 0 0 6px rgba(16, 185, 129, 0.4);
        }

        .jt-val.n {
            color: #f59e0b;
            text-shadow: 0 0 6px rgba(245, 158, 11, 0.4);
        }

        .jt-val.b {
            color: #8b5cf6;
            text-shadow: 0 0 6px rgba(139, 92, 246, 0.4);
        }

        .jt-val.null {
            color: #6b7280;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div id="app">
        <header class="topbar">
            <div class="nav-list" id="siteList"></div>
            <div class="ver" id="verWrap">v<span id="ver"></span></div>
            <button id="btnSettings" class="settings-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                    </path>
                </svg>
                <span>设置</span>
            </button>
        </header>
        <main>
            <div class="status" id="status">加载中...</div>

            <div id="settingsPanel"
                style="position:absolute;right:10px;top:56px;z-index:40;display:none;background:#0f151a;border:1px solid #223038;border-radius:10px;min-width:340px;max-width:520px;box-shadow:0 8px 24px rgba(0,0,0,.3);">
                <div style="display:flex;align-items:center;gap:8px;padding:10px 12px;border-bottom:1px solid #1f262c;">
                    <strong style="flex:1;">设置</strong>
                    <button id="settingsSave"
                        style="background:#2563eb;color:#fff;border:none;border-radius:6px;padding:4px 10px;font-size:12px;cursor:pointer;">保存</button>
                </div>
                <div style="padding:16px 18px;">
                    <div style="margin-bottom:16px;">
                        <div style="font-size:14px;font-weight:600;margin-bottom:8px;color:#e5e7eb;">模块管理</div>
                        <div style="font-size:12px;margin-bottom:12px;color:#9ca3af;">选择要在顶部显示的页面</div>
                        <div id="modulesList" style="display:flex;flex-direction:column;gap:10px;padding-left:4px;">
                        </div>
                    </div>
                </div>
            </div>

            <div id="toast"></div>

            <!-- CURL历史记录浮层 -->
            <div id="historyFloatPanel" class="curl-history-float" style="display: none;">
                <div class="curl-history-float-header">
                    <div class="curl-history-float-title">请求历史</div>
                    <div class="curl-history-float-actions">
                        <button id="historyFloatClose" class="curl-history-float-close">&times;</button>
                    </div>
                </div>
                <div class="curl-history-float-body">
                    <div class="curl-history-float-toolbar">
                        <span id="historyCountBadge" class="curl-history-count-badge">0</span>
                        <button id="clearHistoryBtn" class="curl-history-clear-btn">清空历史</button>
                    </div>
                    <div id="historyList" class="curl-history-list">
                        <!-- 历史记录将动态插入这里 -->
                        <div class="curl-history-empty">暂无历史记录</div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script>
        const builtinSites = [
            { key: 'openai', title: 'OpenAI', url: 'https://chat.openai.com', partition: 'persist:openai' },
            { key: 'gemini', title: 'Gemini', url: 'https://gemini.google.com', partition: 'persist:gemini' },
            { key: 'aistudio', title: 'AIStudio', url: 'https://aistudio.google.com/', partition: 'persist:aistudio' },
            { key: 'deepseek', title: 'DeepSeek', url: 'https://chat.deepseek.com', partition: 'persist:deepseek' },
            { key: 'kimi', title: 'Kimi', url: 'https://kimi.moonshot.cn', partition: 'persist:kimi' },
            { key: 'grok', title: 'Grok', url: 'https://grok.com', partition: 'persist:grok' },
            { key: 'claude', title: 'Claude', url: 'https://claude.ai/', partition: 'persist:claude' },
            { key: 'qianwen', title: '千问', url: 'https://qianwen.aliyun.com/', partition: 'persist:qianwen' },
            { key: 'doubao', title: '豆包', url: 'https://www.doubao.com/', partition: 'persist:doubao' }
        ];
        const sites = (window.llmHub?.sites?.length ? window.llmHub.sites : builtinSites).map(s => ({ ...s }));

        // 从本地存储加载模块可见性设置
        const moduleVisibility = JSON.parse(localStorage.getItem('moduleVisibility') || '{}');
        // 插入时间工具作为一个“站点”
        if (!sites.find(s => s.key === 'time')) {
            sites.push({ key: 'time', title: '时间戳' });
        }
        if (!sites.find(s => s.key === 'pwd')) {
            sites.push({ key: 'pwd', title: '密码生成' });
        }
        if (!sites.find(s => s.key === 'text')) {
            sites.push({ key: 'text', title: '文本统计' });
        }
        if (!sites.find(s => s.key === 'calc')) {
            sites.push({ key: 'calc', title: '计算器' });
        }
        if (!sites.find(s => s.key === 'dns')) {
            sites.push({ key: 'dns', title: 'DNS 解析' });
        }
        if (!sites.find(s => s.key === 'json')) {
            sites.push({ key: 'json', title: 'JSON 解析' });
        }
        if (!sites.find(s => s.key === 'codec')) {
            sites.push({ key: 'codec', title: '编解码工具' });
        }
        if (!sites.find(s => s.key === 'crypto')) {
            sites.push({ key: 'crypto', title: '加解密工具' });
        }
        // 删除这里的货币转换工具初始化，我们将在稍后重新插入
        let current = null;
        const listEl = document.getElementById('siteList');
        const statusEl = document.getElementById('status');
        const verEl = document.getElementById('ver');
        // 独立窗口按钮已移除
        verEl.textContent = window.llmHub?.version || '';

        // 设置面板相关元素
        const btnSettings = document.getElementById('btnSettings');
        const settingsPanel = document.getElementById('settingsPanel');
        const modulesList = document.getElementById('modulesList');
        const settingsSave = document.getElementById('settingsSave');

        function showStatus(text, cls) {
            statusEl.textContent = text;
            statusEl.className = 'status' + (cls ? (' ' + cls) : '');
            statusEl.style.display = 'flex';
        }
        function hideStatus() { statusEl.style.display = 'none'; }
        function siteIcon(title) { return title.slice(0, 2).toUpperCase(); }

        function renderList() {
            listEl.innerHTML = '';
            sites.forEach(s => {
                // 只渲染设置为可见的站点
                if (moduleVisibility[s.key] !== false) {
                    const div = document.createElement('div');
                    div.className = 'item' + (s.key === current ? ' active' : '');
                    div.dataset.key = s.key;
                    div.innerHTML = `<span class="icon">${siteIcon(s.title)}</span><span class="t">${s.title}</span>`;
                    div.onclick = () => switchSite(s.key);
                    listEl.appendChild(div);
                }
            });
        }

        // 时间工具辅助
        function two(n) { return n < 10 ? '0' + n : '' + n; }
        function fmtLocal(dt) {
            const y = dt.getFullYear();
            const M = two(dt.getMonth() + 1);
            const d = two(dt.getDate());
            const h = two(dt.getHours());
            const m = two(dt.getMinutes());
            const s = two(dt.getSeconds());
            return `${y}-${M}-${d} ${h}:${m}:${s}`;
        }
        function copyText(text) {
            const val = String(text ?? '');
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(val).then(() => { toast('已复制'); })
                    .catch(() => fallbackCopy(val));
            } else {
                fallbackCopy(val);
            }
        }
        function fallbackCopy(val) {
            const ta = document.createElement('textarea');
            ta.value = val; document.body.appendChild(ta); ta.select();
            try { document.execCommand('copy'); toast('已复制'); } finally { document.body.removeChild(ta); }
        }
        let toastTimer = null;
        function toast(msg) {
            const el = document.getElementById('toast');
            if (!el) return;
            el.textContent = String(msg || '');
            el.classList.add('show');
            if (toastTimer) clearTimeout(toastTimer);
            toastTimer = setTimeout(() => { el.classList.remove('show'); }, 1300);
        }
        function buildTimeHTML(now) {
            const sec = Math.floor(now.getTime() / 1000);
            const ms = now.getTime();
            const y = now.getFullYear();
            const M = two(now.getMonth() + 1);
            const d = two(now.getDate());
            const hh = two(now.getHours());
            const mm = two(now.getMinutes());
            const ss = two(now.getSeconds());
            return `
                <div class="time-wrap">
                    <div class="time-big">
                        <span class="year">${y}</span><span class="divider">-</span><span class="month">${M}</span><span class="divider">-</span><span class="day">${d}</span>
                        <span class="divider"> </span>
                        <span class="hour">${hh}</span><span class="divider">:</span><span class="minute">${mm}</span><span class="divider">:</span><span class="second">${ss}</span>
                    </div>
                    <div class="time-grid">
                        <div class="stamp-box">
                            <div class="label">Unix 秒</div>
                            <div class="value" id="unixSecVal">${sec}</div>
                            <button class="copy-btn" data-target="unixSecVal" title="复制" aria-label="复制秒时间戳">复制</button>
                        </div>
                        <div class="stamp-box">
                            <div class="label">Unix 毫秒</div>
                            <div class="value" id="unixMsVal">${ms}</div>
                            <button class="copy-btn" data-target="unixMsVal" title="复制" aria-label="复制毫秒时间戳">复制</button>
                        </div>
                        <div class="stamp-box full">
                            <div class="label">时间戳 → 日期时间</div>
                            <input id="tsInput" type="number" inputmode="numeric" placeholder="输入时间戳（秒或毫秒）" />
                            <div class="value" id="tsConvOut"></div>
                            <button class="copy-btn" id="tsCopyBtn" title="复制转换结果" aria-label="复制转换结果">复制</button>
                        </div>
                        <div class="stamp-box full" id="dtRow">
                            <div class="label">日期时间 → 时间戳</div>
                            <input id="dtY" type="number" inputmode="numeric" placeholder="YYYY" style="width: 60px;" />
                            <input id="dtM" type="number" inputmode="numeric" placeholder="MM" style="width: 50px;" />
                            <input id="dtD" type="number" inputmode="numeric" placeholder="DD" style="width: 50px;" />
                            <input id="dtH" type="number" inputmode="numeric" placeholder="hh" style="width: 50px;" />
                            <input id="dtMin" type="number" inputmode="numeric" placeholder="mm" style="width: 50px;" />
                            <input id="dtS" type="number" inputmode="numeric" placeholder="ss" style="width: 50px;" />
                            <div class="value" id="dtConvOut"></div>
                            <button class="copy-btn" id="dtCopyBtn" title="复制转换结果" aria-label="复制转换结果">复制</button>
                        </div>
                    </div>
                </div>`;
        }
        // 密码生成器
        function buildPwdHTML() {
            return `
            <div class="pwd-wrap">
                <div class="pwd-card">
                    <div class="pwd-output">
                        <input id="pwdOut" type="text" readonly placeholder="🔐 点击生成安全密码..." />
                        <button class="pwd-btn" id="pwdGen">⚡ 生成</button>
                        <button class="pwd-btn" id="pwdCopy">📋 复制</button>
                    </div>
                    <div class="pwd-row" style="margin-top:15px;">
                        <div class="pwd-meter" style="flex:1;"><div id="pwdMeterBar"></div></div>
                        <div class="pwd-small" id="pwdStrength">弱</div>
                    </div>
                </div>
                <div class="pwd-grid">
                    <div class="pwd-card">
                        <div class="pwd-kv"><label>🎯 长度</label><div class="range"><input id="pwdLen" type="range" min="8" max="64" step="1" value="16"/><span class="pwd-small" id="pwdLenVal">16</span><input id="pwdLenNum" type="number" min="8" max="64" step="1" value="16"/></div></div>
                        <div class="pwd-opts" style="margin-top:15px;">
                            <label class="opt-chip"><input id="optLower" type="checkbox" checked/> 🔤 小写字母</label>
                            <label class="opt-chip"><input id="optUpper" type="checkbox" checked/> 🔠 大写字母</label>
                            <label class="opt-chip"><input id="optDigits" type="checkbox" checked/> 🔢 数字</label>
                            <label class="opt-chip"><input id="optSymbols" type="checkbox" checked/> 🔣 特殊符号</label>
                        </div>
                    </div>
                </div>
            </div>`;
        }
        function ensurePwd() {
            let pv = document.querySelector('div.pwd-view[data-key="pwd"]');
            if (!pv) {
                pv = document.createElement('div');
                pv.className = 'pwd-view'; pv.dataset.key = 'pwd';
                document.querySelector('main').appendChild(pv);
            }
            pv.innerHTML = buildPwdHTML();
            wirePwd(pv);
            return pv;
        }
        function wirePwd(container) {
            const out = container.querySelector('#pwdOut');
            const genBtn = container.querySelector('#pwdGen');
            const copyBtn = container.querySelector('#pwdCopy');
            const len = container.querySelector('#pwdLen');
            const lenNum = container.querySelector('#pwdLenNum');
            const lenVal = container.querySelector('#pwdLenVal');
            const optLower = container.querySelector('#optLower');
            const optUpper = container.querySelector('#optUpper');
            const optDigits = container.querySelector('#optDigits');
            const optSymbols = container.querySelector('#optSymbols');
            const meterBar = container.querySelector('#pwdMeterBar');
            const strengthTxt = container.querySelector('#pwdStrength');

            function clampLen(v) { return Math.max(8, Math.min(64, Math.floor(Number(v) || 16))); }
            function updateLenVal() { if (lenVal && len) lenVal.textContent = String(len.value); if (lenNum && len) lenNum.value = String(len.value); }

            function pickCharPool() {
                let pool = '';
                if (optLower?.checked) pool += 'abcdefghijklmnopqrstuvwxyz';
                if (optUpper?.checked) pool += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                if (optDigits?.checked) pool += '0123456789';
                if (optSymbols?.checked) pool += '!@#$%^&*_-+=?';
                return pool;
            }
            function genPassword() {
                const L = Number(len?.value || 16);
                let pool = pickCharPool();
                if (!pool) return '';
                let pwd = '';
                const cryptoObj = window.crypto || window['msCrypto'];
                if (cryptoObj && cryptoObj.getRandomValues) {
                    const arr = new Uint32Array(L);
                    cryptoObj.getRandomValues(arr);
                    for (let i = 0; i < L; i++) { pwd += pool[arr[i] % pool.length]; }
                } else {
                    for (let i = 0; i < L; i++) { pwd += pool[Math.floor(Math.random() * pool.length)]; }
                }
                return pwd;
            }
            function estimateStrength(pwd) {
                // 近似估算：字符集大小^长度 的对数换算；映射为 0-100
                const charset = new Set(pwd.split('')).size;
                const L = pwd.length;
                const bits = L > 0 && charset > 1 ? Math.log2(Math.pow(charset, L)) : 0;
                const pct = Math.max(0, Math.min(100, Math.floor(bits / 1.5))); // 粗略映射
                return pct;
            }
            function paintStrength(pwd) {
                const pct = estimateStrength(pwd);
                if (meterBar) {
                    meterBar.style.width = pct + '%';
                    if (pct < 35) {
                        meterBar.style.background = 'linear-gradient(90deg, #ef4444, #ff6b6b)';
                        meterBar.style.boxShadow = '0 0 15px rgba(239, 68, 68, 0.6)';
                    } else if (pct < 70) {
                        meterBar.style.background = 'linear-gradient(90deg, #f59e0b, #fbbf24)';
                        meterBar.style.boxShadow = '0 0 15px rgba(245, 158, 11, 0.6)';
                    } else {
                        meterBar.style.background = 'linear-gradient(90deg, #22c55e, #4ade80)';
                        meterBar.style.boxShadow = '0 0 15px rgba(34, 197, 94, 0.6)';
                    }
                }
                if (strengthTxt) {
                    if (pct < 35) {
                        strengthTxt.textContent = '🔴 弱';
                        strengthTxt.style.color = '#ef4444';
                    } else if (pct < 70) {
                        strengthTxt.textContent = '🟡 中';
                        strengthTxt.style.color = '#f59e0b';
                    } else {
                        strengthTxt.textContent = '🟢 强';
                        strengthTxt.style.color = '#22c55e';
                    }
                }
            }
            function doGen() {
                const pwd = genPassword();
                if (out) {
                    // 添加打字机效果
                    out.value = '';
                    out.style.animation = 'none';
                    setTimeout(() => {
                        out.style.animation = 'pulse 0.5s ease-in-out';
                        typePassword(out, pwd);
                    }, 50);
                }
                paintStrength(pwd);
            }

            function typePassword(input, password) {
                let i = 0;
                const typeInterval = setInterval(() => {
                    if (i < password.length) {
                        input.value += password[i];
                        i++;
                    } else {
                        clearInterval(typeInterval);
                        // 添加完成动画
                        input.style.animation = 'glow 0.8s ease-in-out';
                        setTimeout(() => {
                            input.style.animation = '';
                        }, 800);
                    }
                }, 30);
            }
            genBtn?.addEventListener('click', doGen);
            copyBtn?.addEventListener('click', () => {
                if (out?.value) {
                    copyText(out.value);
                    // 添加复制成功动画
                    copyBtn.style.animation = 'pulse 0.3s ease-in-out';
                    copyBtn.textContent = '✅ 已复制';
                    setTimeout(() => {
                        copyBtn.textContent = '📋 复制';
                        copyBtn.style.animation = '';
                    }, 1500);
                }
            });
            len?.addEventListener('input', () => { updateLenVal(); doGen(); });
            lenNum?.addEventListener('input', () => {
                if (!lenNum || !len) return;
                const v = clampLen(lenNum.value);
                if (String(v) !== String(len.value)) { len.value = String(v); updateLenVal(); doGen(); }
            });
            [optLower, optUpper, optDigits, optSymbols].forEach(el => {
                el?.addEventListener('input', doGen);
                el?.addEventListener('change', doGen);
            });
            // 输出为明文显示
            if (out) out.type = 'text';
            updateLenVal();
            doGen();
        }

        // 文本统计
        function buildTextHTML() {
            return `
            <div class="text-wrap">
                <div class="text-left">
                    <textarea class="text-area" id="textInput" placeholder="✍️ 在此粘贴或输入文本进行统计..."></textarea>
                </div>
                <div class="text-right">
                            <div class="stat-header">统计结果</div>
                            <div class="stat-grid">
                                <div class="stat-item"><div class="label">字符数（含空白）</div><div class="value" id="vChars">0</div></div>
                                <div class="stat-item"><div class="label">字符数（不含空白）</div><div class="value" id="vCharsNoSpace">0</div></div>
                                <div class="stat-item"><div class="label">行数</div><div class="value" id="vLines">0</div></div>
                                <div class="stat-item"><div class="label">单词数</div><div class="value" id="vWords">0</div></div>
                            </div>
                </div>
            </div>`;
        }
        // 计算器
        function buildCalcHTML() {
            return `
            <div class="calc-wrap">
                <div class="calc-result" id="calcOut"></div>
                <div class="calc-display">
                    <input class="calc-input" id="calcExpr" placeholder="输入表达式，例如: (1+2)*3/4 或 2^10" />
                </div>
                <div class="calc-grid">
                    <div class="btn num" data-k="7">7</div>
                    <div class="btn num" data-k="8">8</div>
                    <div class="btn num" data-k="9">9</div>
                    <div class="btn op" data-k="/">÷</div>
                    <div class="btn num" data-k="4">4</div>
                    <div class="btn num" data-k="5">5</div>
                    <div class="btn num" data-k="6">6</div>
                    <div class="btn op" data-k="*">×</div>
                    <div class="btn num" data-k="1">1</div>
                    <div class="btn num" data-k="2">2</div>
                    <div class="btn num" data-k="3">3</div>
                    <div class="btn op" data-k="-">−</div>
                    <div class="btn num" data-k="0">0</div>
                    <div class="btn num" data-k=".">.</div>
                    <div class="btn op" data-k="%">%</div>
                    <div class="btn op" data-k="+">+</div>
                </div>
                <div class="calc-row">
                    <div class="btn ctrl" data-act="ac">AC</div>
                    <div class="btn ctrl" data-act="bk">⌫</div>
                </div>
            </div>`;
        }
        function ensureCalc() {
            let cv = document.querySelector('div.calc-view[data-key="calc"]');
            if (!cv) {
                cv = document.createElement('div');
                cv.className = 'calc-view'; cv.dataset.key = 'calc';
                document.querySelector('main').appendChild(cv);
            }
            cv.innerHTML = buildCalcHTML();
            wireCalc(cv);
            return cv;
        }
        function wireCalc(container) {
            const expr = container.querySelector('#calcExpr');
            const out = container.querySelector('#calcOut');
            // 历史功能已移除

            function formatNumber(n) {
                if (typeof n !== 'number' || !Number.isFinite(n)) return '无穷/非法';
                // 始终使用普通小数表示，最多保留 12 位小数，并去除尾随 0
                const s = n.toFixed(12)
                    .replace(/\.0+$/, '')
                    .replace(/(\.\d*?)0+$/, '$1');
                return s;
            }

            function sanitize(raw) {
                let s = String(raw || '').trim();
                if (!s) return s;
                // 将 ^ 替换为 **
                s = s.replace(/\^/g, '**');
                // 白名单字符检查（仅数字与基本运算符）
                if (!/^[0-9+\-*/%^().\s]+$/.test(s)) throw new Error('含非法字符');
                return s;
            }

            function doEval(commit = false) {
                const raw = expr ? expr.value : '';
                if (!out) return;
                if (!raw.trim()) { out.textContent = ''; out.classList.remove('error'); return; }
                try {
                    const s = sanitize(raw);
                    // 安全求值（仅数字与运算符，已通过白名单过滤）
                    // eslint-disable-next-line no-new-func
                    const fn = new Function('return (' + s + ')');
                    const val = fn();
                    if (typeof val !== 'number' || Number.isNaN(val)) throw new Error('表达式无效');
                    const str = formatNumber(val);
                    out.textContent = str;
                    out.classList.remove('error');
                    if (commit) {
                        // 成功提交时给结果一个轻微弹跳效果
                        out.classList.remove('pop');
                        void out.offsetWidth; // 触发重排以重启动画
                        out.classList.add('pop');
                    }
                } catch (e) {
                    // 错误时不显示任何文本，仅保留错误样式
                    out.textContent = '';
                    out.classList.add('error');
                }
            }

            function insertText(t) {
                if (!expr) return;
                const start = expr.selectionStart ?? expr.value.length;
                const end = expr.selectionEnd ?? expr.value.length;
                const v = expr.value;
                expr.value = v.slice(0, start) + t + v.slice(end);
                const pos = start + t.length;
                expr.setSelectionRange(pos, pos);
                expr.focus();
                doEval();
            }

            // 绑定按钮
            // 防止按钮抢走输入框焦点，保证连续点击可连续删除
            container.querySelectorAll('.btn').forEach(b => b.addEventListener('mousedown', (e) => e.preventDefault()));
            container.querySelectorAll('.calc-grid .btn[data-k]').forEach(b => b.addEventListener('click', () => insertText(b.getAttribute('data-k') || '')));
            container.querySelectorAll('.calc-row .btn[data-k]').forEach(b => b.addEventListener('click', () => insertText(b.getAttribute('data-k') || '')));
            container.querySelector('.calc-row .btn[data-act="ac"]').addEventListener('click', () => {
                if (expr) { expr.value = ''; if (out) out.textContent = ''; try { expr.focus(); expr.setSelectionRange(0, 0); } catch (_) { } doEval(); }
            });
            container.querySelector('.calc-row .btn[data-act="bk"]').addEventListener('click', () => {
                if (!expr) return;
                let start = Number(expr.selectionStart);
                let end = Number(expr.selectionEnd);
                // 当输入未聚焦或浏览器返回无效选择时，回退到在末尾删除
                if (!Number.isInteger(start) || start < 0 || !Number.isInteger(end) || end < 0) {
                    start = end = expr.value.length;
                }
                if (start !== end) {
                    const v = expr.value; expr.value = v.slice(0, start) + v.slice(end);
                    try { expr.focus(); expr.setSelectionRange(start, start); } catch (_) { }
                } else if (start > 0) {
                    const v = expr.value; expr.value = v.slice(0, start - 1) + v.slice(end);
                    const pos = start - 1;
                    try { expr.focus(); expr.setSelectionRange(pos, pos); } catch (_) { }
                }
                doEval();
            });
            // 等号按钮已移除，使用 Enter 键提交
            expr?.addEventListener('input', () => doEval());
            expr?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') { e.preventDefault(); doEval(true); }
            });

            doEval();
        }
        function ensureText() {
            let tv = document.querySelector('div.text-view[data-key="text"]');
            if (!tv) {
                tv = document.createElement('div');
                tv.className = 'text-view'; tv.dataset.key = 'text';
                document.querySelector('main').appendChild(tv);
            }
            tv.innerHTML = buildTextHTML();
            wireText(tv);
            return tv;
        }
        // JSON 解析
        function buildJsonHTML() {
            return `
            <div class="json-wrap">
                <div class="json-split">
                    <div class="json-left">
                        <div class="json-toolbar">
                            <button class="json-btn" id="jsonFmt">格式化</button>
                            <button class="json-btn" id="jsonMin">压缩</button>
                            <button class="json-btn" id="jsonSort">按键排序</button>
                            <button class="json-btn" id="jsonCopy">复制</button>
                            <button class="json-btn" id="jsonExpand">展开全部</button>
                            <button class="json-btn" id="jsonCollapse">折叠全部</button>
                            <button class="json-btn" id="jsonPaste">粘贴</button>
                            <button class="json-btn" id="jsonClear">清空</button>
                        </div>
                        <textarea class="json-input" id="jsonIn" placeholder='粘贴或输入 JSON，例如 {"a":1,"b":[true,null]}'></textarea>
                        <div class="json-err" id="jsonErr"></div>
                    </div>
                    <div class="json-right">
                        <div class="json-tabs">
                            <div class="json-tab active" data-t="tree">树形</div>
                            <div class="json-tab" data-t="raw">原文</div>
                        </div>
                        <div class="json-panel" id="jsonOut"></div>
                    </div>
                </div>
            </div>`;
        }
        function ensureJson() {
            let jv = document.querySelector('div.json-view[data-key="json"]');
            if (!jv) {
                jv = document.createElement('div');
                jv.className = 'json-view'; jv.dataset.key = 'json';
                document.querySelector('main').appendChild(jv);
            }
            jv.innerHTML = buildJsonHTML();
            wireJson(jv);
            return jv;
        }
        function wireJson(container) {
            const ta = container.querySelector('#jsonIn');
            const out = container.querySelector('#jsonOut');
            const err = container.querySelector('#jsonErr');
            const tabs = container.querySelectorAll('.json-tab');
            let mode = 'tree';

            function safeParse(text) {
                try { return { ok: true, data: JSON.parse(text) }; } catch (e) { return { ok: false, err: e }; }
            }
            function sortKeys(value) {
                if (Array.isArray(value)) return value.map(sortKeys);
                if (value && typeof value === 'object') {
                    return Object.keys(value).sort().reduce((acc, k) => { acc[k] = sortKeys(value[k]); return acc; }, {});
                }
                return value;
            }
            // JSON 路径查询功能已移除
            function esc(s) { return String(s).replace(/[&<>]/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;' }[m])); }
            function renderTree(value) {
                function makeNode(key, v, depth = 0) {
                    const isArr = Array.isArray(v);
                    const t = v === null ? 'null' : typeof v;
                    const li = document.createElement('div');
                    li.className = 'jt-node';
                    const head = document.createElement('div'); head.className = 'jt-head';
                    const caret = document.createElement('span'); caret.className = isArr || t === 'object' ? 'jt-caret' : 'jt-leaf'; head.appendChild(caret);
                    if (key !== undefined) {
                        const k = document.createElement('span'); k.className = 'jt-key'; k.textContent = typeof key === 'string' ? `"${key}"` : String(key); head.appendChild(k);
                        head.appendChild(document.createTextNode(':'));
                    }
                    if (t === 'string' || t === 'number' || t === 'boolean' || t === 'null') {
                        const val = document.createElement('span'); val.className = 'jt-val ' + (t === 'string' ? 's' : t === 'number' ? 'n' : t === 'boolean' ? 'b' : 'null');
                        val.textContent = t === 'string' ? `"${v}"` : String(v);
                        head.appendChild(val);
                        li.appendChild(head);
                        return li;
                    }
                    const summary = document.createElement('span'); summary.className = 'jt-sum';
                    if (isArr) summary.textContent = `[${v.length}]`;
                    else summary.textContent = `{${Object.keys(v || {}).length}}`;
                    head.appendChild(summary);
                    li.appendChild(head);
                    const ch = document.createElement('div'); ch.className = 'jt-children';
                    if (isArr) {
                        v.forEach((item, idx) => ch.appendChild(makeNode(idx, item, depth + 1)));
                    } else {
                        Object.keys(v || {}).forEach(k => ch.appendChild(makeNode(k, v[k], depth + 1)));
                    }
                    li.appendChild(ch);
                    // 默认不折叠，初始即为展开状态
                    head.addEventListener('click', () => { if (isArr || t === 'object') li.classList.toggle('collapsed'); });
                    return li;
                }
                const root = document.createElement('div'); root.className = 'jtree';
                root.appendChild(makeNode(undefined, value, 0));
                out.innerHTML = '';
                out.appendChild(root);
            }
            function renderRaw(value) {
                out.textContent = JSON.stringify(value, null, 2);
            }
            function showErr(msg) { if (err) err.textContent = msg || ''; }

            function refresh() {
                const text = ta?.value || '';
                if (!text.trim()) { out.textContent = ''; showErr(''); return; }
                const parsed = safeParse(text);
                if (!parsed.ok) { out.textContent = ''; showErr('JSON 解析失败'); return; }
                const view = parsed.data;
                showErr('');
                if (mode === 'tree') renderTree(view); else renderRaw(view);
            }

            container.querySelector('#jsonFmt')?.addEventListener('click', () => {
                const text = ta?.value || '';
                const parsed = safeParse(text);
                if (!parsed.ok) { showErr('JSON 解析失败'); return; }
                ta.value = JSON.stringify(parsed.data, null, 2);
                refresh();
            });
            container.querySelector('#jsonMin')?.addEventListener('click', () => {
                const text = ta?.value || '';
                const parsed = safeParse(text);
                if (!parsed.ok) { showErr('JSON 解析失败'); return; }
                ta.value = JSON.stringify(parsed.data);
                refresh();
            });
            container.querySelector('#jsonSort')?.addEventListener('click', () => {
                const text = ta?.value || '';
                const parsed = safeParse(text);
                if (!parsed.ok) { showErr('JSON 解析失败'); return; }
                const sorted = sortKeys(parsed.data);
                ta.value = JSON.stringify(sorted, null, 2);
                refresh();
            });
            container.querySelector('#jsonCopy')?.addEventListener('click', () => {
                const text = out?.textContent || '';
                if (text) copyText(text);
            });
            container.querySelector('#jsonPaste')?.addEventListener('click', async () => {
                try { const t = await navigator.clipboard.readText(); if (ta) { ta.value = t; refresh(); } }
                catch { showErr('无法读取剪贴板'); }
            });
            container.querySelector('#jsonClear')?.addEventListener('click', () => { if (ta) { ta.value = ''; refresh(); } });
            ta?.addEventListener('input', () => refresh());
            // 路径回车监听已移除
            tabs.forEach(tab => tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                mode = tab.getAttribute('data-t') || 'tree';
                refresh();
            }));
            container.querySelector('#jsonExpand')?.addEventListener('click', () => {
                out.querySelectorAll('.jt-node').forEach(n => n.classList.remove('collapsed'));
            });
            container.querySelector('#jsonCollapse')?.addEventListener('click', () => {
                out.querySelectorAll('.jt-node').forEach(n => n.classList.add('collapsed'));
            });
        }
        function wireText(container) {
            const ta = container.querySelector('#textInput');
            const vChars = container.querySelector('#vChars');
            const vCharsNoSpace = container.querySelector('#vCharsNoSpace');
            const vLines = container.querySelector('#vLines');
            const vWords = container.querySelector('#vWords');
            function calc() {
                const val = String(ta?.value || '');
                const chars = val.length;
                const charsNoSpace = val.replace(/[\s]/g, '').length;
                const lines = val ? val.split(/\r?\n/).length : 0;
                const words = (val.trim().match(/[^\s]+/g) || []).length;
                if (vChars) vChars.textContent = String(chars);
                if (vCharsNoSpace) vCharsNoSpace.textContent = String(charsNoSpace);
                if (vLines) vLines.textContent = String(lines);
                if (vWords) vWords.textContent = String(words);
            }
            ta?.addEventListener('input', calc);
            calc();
        }

        // DNS 解析
        function buildDnsHTML() {
            return `
            <div class="dns-wrap">
                <div class="dns-split">
                    <div class="dns-left">
                        <div class="dns-form">
                            <input class="dns-input" id="dnsHost" placeholder="输入域名，如: example.com" />
                            <select class="dns-select" id="dnsType">
                        <option>A</option>
                        <option>AAAA</option>
                        <option>CNAME</option>
                        <option>TXT</option>
                        <option>MX</option>
                        <option>NS</option>
                        <option>SRV</option>
                        <option>CAA</option>
                        <option>PTR</option>
                            </select>
                            <button class="dns-btn" id="dnsQuery">解析</button>
                        </div>
                        <div class="dns-chips">
                            <label class="chip"><input id="dnsUseGoogle" type="checkbox" checked/> Google DoH</label>
                            <label class="chip"><input id="dnsUseCf" type="checkbox" checked/> Cloudflare DoH</label>
                            <label class="chip"><input id="dnsTrace" type="checkbox"/> 启用调试</label>
                            <label class="chip"><input id="dnsTbl" type="checkbox"/> 表格模式</label>
                            <label class="chip"><input id="dnsUseCustom" type="checkbox"/> 自定义 DoH</label>
                        </div>
                        <input class="dns-input" id="dnsCustomEp" placeholder="自定义 DoH 端点（JSON 接口），如 https://dns.example.com/dns-query" style="display:none; width:100%;" />
                    </div>
                    <div class="dns-right">
                        <div class="dns-grid">
                            <div class="dns-card">
                                <h4>Google 结果 <button class="dns-copy" data-target="g">复制</button></h4>
                                <div class="dns-list" id="dnsG"></div>
                                <div class="dns-meta" id="dnsGm"></div>
                                <div class="dns-err" id="dnsGe"></div>
                            </div>
                            <div class="dns-card">
                                <h4>Cloudflare 结果 <button class="dns-copy" data-target="c">复制</button></h4>
                                <div class="dns-list" id="dnsC"></div>
                                <div class="dns-meta" id="dnsCm"></div>
                                <div class="dns-err" id="dnsCe"></div>
                            </div>
                            <div class="dns-card full" id="dnsCustomCard" style="display:none;">
                                <h4>自定义 DoH 结果 <button class="dns-copy" data-target="u">复制</button></h4>
                                <div class="dns-list" id="dnsU"></div>
                                <div class="dns-meta" id="dnsUm"></div>
                                <div class="dns-err" id="dnsUe"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
        }
        function ensureDns() {
            let dv = document.querySelector('div.dns-view[data-key="dns"]');
            if (!dv) {
                dv = document.createElement('div');
                dv.className = 'dns-view'; dv.dataset.key = 'dns';
                document.querySelector('main').appendChild(dv);
            }
            dv.innerHTML = buildDnsHTML();
            wireDns(dv);
            return dv;
        }
        function wireDns(container) {
            const host = container.querySelector('#dnsHost');
            const type = container.querySelector('#dnsType');
            const btn = container.querySelector('#dnsQuery');
            const useG = container.querySelector('#dnsUseGoogle');
            const useC = container.querySelector('#dnsUseCf');
            const trace = container.querySelector('#dnsTrace');
            const tbl = container.querySelector('#dnsTbl');
            const useU = container.querySelector('#dnsUseCustom');
            const customEp = container.querySelector('#dnsCustomEp');
            const gList = container.querySelector('#dnsG');
            const cList = container.querySelector('#dnsC');
            const uList = container.querySelector('#dnsU');
            const gMeta = container.querySelector('#dnsGm');
            const cMeta = container.querySelector('#dnsCm');
            const uMeta = container.querySelector('#dnsUm');
            const gErr = container.querySelector('#dnsGe');
            const cErr = container.querySelector('#dnsCe');
            const uErr = container.querySelector('#dnsUe');
            const uCard = container.querySelector('#dnsCustomCard');

            function normalizeName(n) {
                n = String(n || '').trim();
                if (!n) return '';
                // 去掉 http(s):// 与尾部斜杠
                n = n.replace(/^https?:\/\//i, '').replace(/[\/?#].*$/, '');
                return n;
            }
            function rrToRow(rr) {
                if (!rr) return null;
                const t = rr.type;
                const name = rr.name || rr.NAME || rr.Name || '';
                const ttl = rr.TTL ?? rr.ttl ?? '';
                let data = '';
                if (t === 1 || t === 'A') data = rr.data || rr.A || rr.ip || '';
                else if (t === 28 || t === 'AAAA') data = rr.data || rr.AAAA || rr.ip || '';
                else if (t === 5 || t === 'CNAME') data = rr.data || rr.cname || '';
                else if (t === 16 || t === 'TXT') {
                    const d = rr.data || rr.txt || rr.TXT;
                    data = Array.isArray(d) ? d.join(' ') : String(d || '');
                }
                else if (t === 15 || t === 'MX') {
                    const p = rr.preference ?? rr.PRIORITY ?? rr.priority ?? '';
                    const e = rr.exchange ?? rr.data ?? '';
                    data = (p ? (p + " ") : '') + e;
                }
                else if (t === 2 || t === 'NS') data = rr.data || rr.ns || '';
                else if (t === 33 || t === 'SRV') {
                    const pr = rr.priority ?? rr.PRIORITY ?? 0;
                    const wt = rr.weight ?? rr.weight ?? 0;
                    const port = rr.port ?? 0;
                    const trg = rr.target ?? rr.data ?? '';
                    data = `${pr} ${wt} ${port} ${trg}`;
                }
                else if (t === 257 || t === 'CAA') {
                    const fl = rr.flags ?? 0;
                    const tag = rr.tag ?? '';
                    const val = rr.value ?? rr.data ?? '';
                    data = `${fl} ${tag} "${val}"`;
                }
                else if (t === 12 || t === 'PTR') {
                    data = rr.data || rr.ptrdname || rr.PTR || '';
                }
                else data = rr.data || '';
                return { name, type: (typeof t === 'number' ? t : String(t)), ttl, data };
            }
            function renderList(el, list) {
                if (!el) return;
                if (!list || !list.length) { el.innerHTML = '<div class="dns-empty">暂无结果</div>'; return; }
                el.textContent = list.join('\n');
            }
            function renderTable(el, rows) {
                if (!el) return;
                if (!rows || !rows.length) { el.innerHTML = '<div class="dns-empty">暂无结果</div>'; return; }
                const thead = '<thead><tr><th>NAME</th><th>TYPE</th><th>TTL</th><th>DATA</th></tr></thead>';
                const tbody = '<tbody>' + rows.map(r => `<tr><td>${r.name || ''}</td><td>${r.type}</td><td>${r.ttl || ''}</td><td>${r.data || ''}</td></tr>`).join('') + '</tbody>';
                el.innerHTML = `<table class="dns-table">${thead}${tbody}</table>`;
            }
            function setMeta(el, ms, from) { if (el) el.textContent = `耗时 ${ms}ms · 源 ${from}`; }
            function setErr(el, e) { if (el) el.textContent = e ? String(e) : ''; }

            async function dohGoogle(name, rr) {
                const url = `https://dns.google/resolve?name=${encodeURIComponent(name)}&type=${encodeURIComponent(rr)}`;
                const t0 = performance.now();
                const res = await fetch(url, { method: 'GET' });
                const t1 = performance.now();
                const data = await res.json();
                const ms = Math.round(t1 - t0);
                const list = (data.Answer || []).map(a => rrToRow(a)).filter(Boolean);
                return { list, ms, raw: trace?.checked ? data : null };
            }
            async function dohCf(name, rr) {
                const url = `https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(name)}&type=${encodeURIComponent(rr)}`;
                const t0 = performance.now();
                const res = await fetch(url, { headers: { 'Accept': 'application/dns-json' } });
                const t1 = performance.now();
                const data = await res.json();
                const ms = Math.round(t1 - t0);
                const list = (data.Answer || []).map(a => rrToRow(a)).filter(Boolean);
                return { list, ms, raw: trace?.checked ? data : null };
            }
            async function dohCustom(ep, name, rr) {
                const base = String(ep || '').trim();
                const hasQuery = base.includes('?');
                const url = `${base}${hasQuery ? '&' : '?'}name=${encodeURIComponent(name)}&type=${encodeURIComponent(rr)}`;
                const t0 = performance.now();
                const res = await fetch(url, { headers: { 'Accept': 'application/dns-json' } });
                const t1 = performance.now();
                const data = await res.json();
                const ms = Math.round(t1 - t0);
                const list = (data.Answer || []).map(a => rrToRow(a)).filter(Boolean);
                return { list, ms, raw: trace?.checked ? data : null };
            }

            function toArpa(ipv4) {
                // 1.2.3.4 -> 4.3.2.1.in-addr.arpa
                const m = String(ipv4 || '').trim().match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/);
                if (!m) return '';
                return `${m[4]}.${m[3]}.${m[2]}.${m[1]}.in-addr.arpa`;
            }

            async function run() {
                let name = normalizeName(host?.value);
                let rr = (type?.value || 'A').toUpperCase();
                // IPv4 PTR 自动转换
                if (rr === 'PTR' && /^\d{1,3}(?:\.\d{1,3}){3}$/.test(name)) {
                    const arpa = toArpa(name);
                    if (arpa) name = arpa;
                }
                if (!name) { toast('请输入域名'); return; }
                // 清空
                [gList, cList, uList].forEach(el => { if (el) el.innerHTML = ''; });
                [gMeta, cMeta, uMeta].forEach(el => { if (el) el.textContent = ''; });
                [gErr, cErr, uErr].forEach(el => { if (el) el.textContent = ''; });
                const tasks = [];
                if (useG?.checked) tasks.push(dohGoogle(name, rr).then(r => ({ who: 'Google', ...r })).catch(e => ({ who: 'Google', error: e })));
                if (useC?.checked) tasks.push(dohCf(name, rr).then(r => ({ who: 'Cloudflare', ...r })).catch(e => ({ who: 'Cloudflare', error: e })));
                if (useU?.checked) {
                    const ep = customEp?.value || '';
                    if (!ep.trim()) { toast('请填写自定义 DoH 端点'); }
                    else tasks.push(dohCustom(ep, name, rr).then(r => ({ who: 'Custom', ...r })).catch(e => ({ who: 'Custom', error: e })));
                }
                if (!tasks.length) { toast('请至少选择一个解析源'); return; }
                const results = await Promise.all(tasks);
                for (const r of results) {
                    if (r.who === 'Google') {
                        if (r.error) { setErr(gErr, r.error); continue; }
                        if (tbl?.checked) renderTable(gList, r.list); else renderList(gList, r.list.map(x => x.data).filter(Boolean));
                        setMeta(gMeta, r.ms, 'Google');
                        if (trace?.checked && r.raw) gMeta.textContent += ` · 状态 ${r.raw.Status}`;
                    } else if (r.who === 'Cloudflare') {
                        if (r.error) { setErr(cErr, r.error); continue; }
                        if (tbl?.checked) renderTable(cList, r.list); else renderList(cList, r.list.map(x => x.data).filter(Boolean));
                        setMeta(cMeta, r.ms, 'Cloudflare');
                        if (trace?.checked && r.raw) cMeta.textContent += ` · 状态 ${r.raw.Status}`;
                    } else if (r.who === 'Custom') {
                        if (r.error) { setErr(uErr, r.error); continue; }
                        if (tbl?.checked) renderTable(uList, r.list); else renderList(uList, r.list.map(x => x.data).filter(Boolean));
                        setMeta(uMeta, r.ms, 'Custom');
                        if (trace?.checked && r.raw) uMeta.textContent += ` · 状态 ${r.raw.Status}`;
                    }
                }
            }
            btn?.addEventListener('click', run);
            host?.addEventListener('keydown', e => { if (e.key === 'Enter') run(); });
            container.querySelectorAll('.dns-copy').forEach(b => b.addEventListener('click', () => {
                const t = b.getAttribute('data-target');
                const el = t === 'g' ? gList : t === 'c' ? cList : uList;
                const text = (el?.textContent || '').trim();
                if (text) copyText(text);
            }));

            // 自定义端点输入显隐
            useU?.addEventListener('change', () => {
                if (!customEp) return;
                customEp.style.display = useU.checked ? 'block' : 'none';
                if (uCard) uCard.style.display = useU.checked ? 'block' : 'none';
            });
            if (uCard) uCard.style.display = useU?.checked ? 'block' : 'none';
            if (customEp) customEp.style.display = useU?.checked ? 'block' : 'none';
        }

        // 编解码工具
        function buildCodecHTML() {
            return `
            <div class="codec-wrap">
                <div class="codec-tabs">
                    <div class="codec-tab active" data-tab="url">URL 编解码</div>
                    <div class="codec-tab" data-tab="base64">Base64 编解码</div>
                    <div class="codec-tab" data-tab="unicode">Unicode 编解码</div>
                </div>
                
                <!-- URL 编解码 -->
                <div class="codec-panel active" data-panel="url">
                    <div class="codec-side">
                        <div class="codec-label">原文 (URL 解码后)</div>
                        <textarea class="codec-textarea" id="urlDecoded" placeholder="输入原始文本..."></textarea>
                        <div class="codec-buttons">
                            <button class="codec-btn primary" id="urlEncode">URL 编码</button>
                            <button class="codec-btn" id="urlClear">清空</button>
                        </div>
                        <div class="codec-error" id="urlError"></div>
                    </div>
                    <div class="codec-side">
                        <div class="codec-label">编码后 (URL 编码)</div>
                        <textarea class="codec-textarea" id="urlEncoded" placeholder="编码结果或输入编码文本..."></textarea>
                        <div class="codec-buttons">
                            <button class="codec-btn primary" id="urlDecode">URL 解码</button>
                            <button class="codec-btn" id="urlCopy">复制</button>
                        </div>
                    </div>
                </div>
                
                <!-- Base64 编解码 -->
                <div class="codec-panel" data-panel="base64">
                    <div class="codec-side">
                        <div class="codec-label">原文 (Base64 解码后)</div>
                        <textarea class="codec-textarea" id="base64Decoded" placeholder="输入原始文本..."></textarea>
                        <div class="codec-buttons">
                            <button class="codec-btn primary" id="base64Encode">Base64 编码</button>
                            <button class="codec-btn" id="base64Clear">清空</button>
                        </div>
                        <div class="codec-error" id="base64Error"></div>
                    </div>
                    <div class="codec-side">
                        <div class="codec-label">编码后 (Base64 编码)</div>
                        <textarea class="codec-textarea" id="base64Encoded" placeholder="编码结果或输入Base64文本..."></textarea>
                        <div class="codec-buttons">
                            <button class="codec-btn primary" id="base64Decode">Base64 解码</button>
                            <button class="codec-btn" id="base64Copy">复制</button>
                        </div>
                    </div>
                </div>
                
                <!-- Unicode 编解码 -->
                <div class="codec-panel" data-panel="unicode">
                    <div class="codec-side">
                        <div class="codec-label">原文 (Unicode 解码后)</div>
                        <textarea class="codec-textarea" id="unicodeDecoded" placeholder="输入原始文本..."></textarea>
                        <div class="codec-buttons">
                            <button class="codec-btn primary" id="unicodeEncode">Unicode 编码</button>
                            <button class="codec-btn" id="unicodeClear">清空</button>
                        </div>
                        <div class="codec-error" id="unicodeError"></div>
                    </div>
                    <div class="codec-side">
                        <div class="codec-label">编码后 (Unicode 编码)</div>
                        <textarea class="codec-textarea" id="unicodeEncoded" placeholder="编码结果或输入Unicode文本..."></textarea>
                        <div class="codec-buttons">
                            <button class="codec-btn primary" id="unicodeDecode">Unicode 解码</button>
                            <button class="codec-btn" id="unicodeCopy">复制</button>
                        </div>
                    </div>
                </div>
            </div>`;
        }

        function ensureCodec() {
            let cv = document.querySelector('div.codec-view[data-key="codec"]');
            if (!cv) {
                cv = document.createElement('div');
                cv.className = 'codec-view'; cv.dataset.key = 'codec';
                document.querySelector('main').appendChild(cv);
            }
            cv.innerHTML = buildCodecHTML();
            wireCodec(cv);
            return cv;
        }

        function wireCodec(container) {
            // 标签切换
            const tabs = container.querySelectorAll('.codec-tab');
            const panels = container.querySelectorAll('.codec-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.getAttribute('data-tab');
                    tabs.forEach(t => t.classList.remove('active'));
                    panels.forEach(p => p.classList.remove('active'));
                    tab.classList.add('active');
                    container.querySelector(`[data-panel="${target}"]`).classList.add('active');
                });
            });

            // URL 编解码
            const urlDecoded = container.querySelector('#urlDecoded');
            const urlEncoded = container.querySelector('#urlEncoded');
            const urlError = container.querySelector('#urlError');

            container.querySelector('#urlEncode').addEventListener('click', () => {
                try {
                    const text = urlDecoded.value;
                    urlEncoded.value = encodeURIComponent(text);
                    urlError.style.display = 'none';
                } catch (e) {
                    urlError.textContent = '编码失败：' + e.message;
                    urlError.style.display = 'block';
                }
            });

            container.querySelector('#urlDecode').addEventListener('click', () => {
                try {
                    const text = urlEncoded.value;
                    urlDecoded.value = decodeURIComponent(text);
                    urlError.style.display = 'none';
                } catch (e) {
                    urlError.textContent = '解码失败：' + e.message;
                    urlError.style.display = 'block';
                }
            });

            container.querySelector('#urlClear').addEventListener('click', () => {
                urlDecoded.value = '';
                urlEncoded.value = '';
                urlError.style.display = 'none';
            });

            container.querySelector('#urlCopy').addEventListener('click', () => {
                const text = urlEncoded.value || urlDecoded.value;
                if (text) {
                    copyText(text);
                } else {
                    toast('无内容可复制');
                }
            });

            // Base64 编解码
            const base64Decoded = container.querySelector('#base64Decoded');
            const base64Encoded = container.querySelector('#base64Encoded');
            const base64Error = container.querySelector('#base64Error');

            container.querySelector('#base64Encode').addEventListener('click', () => {
                try {
                    const text = base64Decoded.value;
                    base64Encoded.value = btoa(unescape(encodeURIComponent(text)));
                    base64Error.style.display = 'none';
                } catch (e) {
                    base64Error.textContent = '编码失败：' + e.message;
                    base64Error.style.display = 'block';
                }
            });

            container.querySelector('#base64Decode').addEventListener('click', () => {
                try {
                    const text = base64Encoded.value;
                    base64Decoded.value = decodeURIComponent(escape(atob(text)));
                    base64Error.style.display = 'none';
                } catch (e) {
                    base64Error.textContent = '解码失败：' + e.message;
                    base64Error.style.display = 'block';
                }
            });

            container.querySelector('#base64Clear').addEventListener('click', () => {
                base64Decoded.value = '';
                base64Encoded.value = '';
                base64Error.style.display = 'none';
            });

            container.querySelector('#base64Copy').addEventListener('click', () => {
                const text = base64Encoded.value || base64Decoded.value;
                if (text) {
                    copyText(text);
                } else {
                    toast('无内容可复制');
                }
            });

            // Unicode 编解码
            const unicodeDecoded = container.querySelector('#unicodeDecoded');
            const unicodeEncoded = container.querySelector('#unicodeEncoded');
            const unicodeError = container.querySelector('#unicodeError');

            container.querySelector('#unicodeEncode').addEventListener('click', () => {
                try {
                    const text = unicodeDecoded.value;
                    let result = '';
                    for (let i = 0; i < text.length; i++) {
                        const code = text.charCodeAt(i);
                        result += '\\\\u' + code.toString(16).padStart(4, '0');
                    }
                    unicodeEncoded.value = result;
                    unicodeError.style.display = 'none';
                } catch (e) {
                    unicodeError.textContent = '编码失败：' + e.message;
                    unicodeError.style.display = 'block';
                }
            });

            container.querySelector('#unicodeDecode').addEventListener('click', () => {
                try {
                    const text = unicodeEncoded.value;
                    const result = text.replace(/\\\\u([0-9a-fA-F]{4})/g, (match, hex) => {
                        return String.fromCharCode(parseInt(hex, 16));
                    });
                    unicodeDecoded.value = result;
                    unicodeError.style.display = 'none';
                } catch (e) {
                    unicodeError.textContent = '解码失败：' + e.message;
                    unicodeError.style.display = 'block';
                }
            });

            container.querySelector('#unicodeClear').addEventListener('click', () => {
                unicodeDecoded.value = '';
                unicodeEncoded.value = '';
                unicodeError.style.display = 'none';
            });

            container.querySelector('#unicodeCopy').addEventListener('click', () => {
                const text = unicodeEncoded.value || unicodeDecoded.value;
                if (text) {
                    copyText(text);
                } else {
                    toast('无内容可复制');
                }
            });
        }

        // 加解密工具
        function buildCryptoHTML() {
            return `
            <div class="crypto-wrap">
                <div class="crypto-tabs">
                    <div class="crypto-tab active" data-tab="md5">MD5 哈希</div>
                    <div class="crypto-tab" data-tab="aes">AES 加解密</div>
                    <div class="crypto-tab" data-tab="des">DES 加解密</div>
                </div>
                
                <div class="crypto-panel active" data-panel="md5">
                    <div class="crypto-side">
                        <div class="crypto-label">输入文本</div>
                        <textarea class="crypto-textarea" id="md5Input" placeholder="输入要计算MD5的文本..."></textarea>
                        <div class="crypto-controls">
                            <button class="crypto-btn" id="md5Generate">生成MD5</button>
                            <button class="crypto-btn" id="md5Clear">清空</button>
                        </div>
                        <div class="crypto-error" id="md5Error" style="color:#fca5a5;font-size:12px;margin-top:6px;display:none;"></div>
                    </div>
                    <div class="crypto-side">
                        <div class="crypto-label">MD5 结果</div>
                        <div style="display: flex; flex-direction: column; gap: 8px; height: 100%; width: 100%;">
                            <div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                                    <div class="crypto-label" style="font-size: 13px; margin-bottom: 0;">32位小写</div>
                                    <button class="crypto-btn" id="md5Copy32Lower" style="padding: 3px 6px; font-size: 11px;">复制</button>
                                </div>
                                <textarea class="crypto-textarea" id="md5Output32Lower" placeholder="32位小写MD5..." readonly style="height: 60px; min-height: 50px; width: 100%;"></textarea>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                                    <div class="crypto-label" style="font-size: 13px; margin-bottom: 0;">32位大写</div>
                                    <button class="crypto-btn" id="md5Copy32Upper" style="padding: 3px 6px; font-size: 11px;">复制</button>
                                </div>
                                <textarea class="crypto-textarea" id="md5Output32Upper" placeholder="32位大写MD5..." readonly style="height: 60px; min-height: 50px; width: 100%;"></textarea>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                                    <div class="crypto-label" style="font-size: 13px; margin-bottom: 0;">16位小写</div>
                                    <button class="crypto-btn" id="md5Copy16Lower" style="padding: 3px 6px; font-size: 11px;">复制</button>
                                </div>
                                <textarea class="crypto-textarea" id="md5Output16Lower" placeholder="16位小写MD5..." readonly style="height: 60px; min-height: 50px; width: 100%;"></textarea>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px;">
                                    <div class="crypto-label" style="font-size: 13px; margin-bottom: 0;">16位大写</div>
                                    <button class="crypto-btn" id="md5Copy16Upper" style="padding: 3px 6px; font-size: 11px;">复制</button>
                                </div>
                                <textarea class="crypto-textarea" id="md5Output16Upper" placeholder="16位大写MD5..." readonly style="height: 60px; min-height: 50px; width: 100%;"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="crypto-panel" data-panel="aes">
                    <div class="crypto-side">
                        <div class="crypto-label">输入文本</div>
                        <textarea class="crypto-textarea" id="aesInput" placeholder="输入要加密/解密的文本..."></textarea>
                        <div class="crypto-label">密钥 (Key)</div>
                        <input class="crypto-input" id="aesKey" placeholder="输入AES密钥..." type="text" />
                        <div class="crypto-controls">
                            <button class="crypto-btn" id="aesEncrypt">AES 加密</button>
                            <button class="crypto-btn" id="aesDecrypt">AES 解密</button>
                            <button class="crypto-btn" id="aesClear">清空</button>
                            <button class="crypto-btn" id="aesCopy">复制结果</button>
                        </div>
                        <div class="crypto-error" id="aesError" style="color:#fca5a5;font-size:12px;margin-top:6px;display:none;"></div>
                    </div>
                    <div class="crypto-side">
                        <div class="crypto-label">加密/解密结果</div>
                        <textarea class="crypto-textarea" id="aesOutput" placeholder="加密/解密结果将显示在这里..." readonly></textarea>
                    </div>
                </div>
                
                <div class="crypto-panel" data-panel="des">
                    <div class="crypto-side">
                        <div class="crypto-label">输入文本</div>
                        <textarea class="crypto-textarea" id="desInput" placeholder="输入要加密/解密的文本..."></textarea>
                        <div class="crypto-label">密钥 (Key)</div>
                        <input class="crypto-input" id="desKey" placeholder="输入DES密钥(8字节)..." type="text" />
                        <div class="crypto-controls">
                            <button class="crypto-btn" id="desEncrypt">DES 加密</button>
                            <button class="crypto-btn" id="desDecrypt">DES 解密</button>
                            <button class="crypto-btn" id="desClear">清空</button>
                            <button class="crypto-btn" id="desCopy">复制结果</button>
                        </div>
                        <div class="crypto-error" id="desError" style="color:#fca5a5;font-size:12px;margin-top:6px;display:none;"></div>
                    </div>
                    <div class="crypto-side">
                        <div class="crypto-label">加密/解密结果</div>
                        <textarea class="crypto-textarea" id="desOutput" placeholder="加密/解密结果将显示在这里..." readonly></textarea>
                    </div>
                </div>
            </div>`;
        }

        function ensureCrypto() {
            let cv = document.querySelector('div.crypto-view[data-key="crypto"]');
            if (!cv) {
                cv = document.createElement('div');
                cv.className = 'crypto-view'; cv.dataset.key = 'crypto';
                document.querySelector('main').appendChild(cv);
            }
            cv.innerHTML = buildCryptoHTML();
            wireCrypto(cv);
            return cv;
        }

        function buildCurrencyHTML() {
            return `<div class="currency-container">
                <div class="currency-content">
                    <div class="currency-card">
                        <div class="form-group">
                            <div class="input-group">
                                <input type="text" id="amountInput" placeholder="输入金额" class="currency-input">
                                <select id="fromCurrency" class="currency-select">
                                    <option value="CNY">人民币 (CNY)</option>
                                    <option value="USD">美元 (USD)</option>
                                    <option value="EUR">欧元 (EUR)</option>
                                    <option value="JPY">日元 (JPY)</option>
                                    <option value="GBP">英镑 (GBP)</option>
                                    <option value="KRW">韩元 (KRW)</option>
                                    <option value="HKD">港币 (HKD)</option>
                                    <option value="AUD">澳元 (AUD)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="swap-btn-container">
                            <button id="swapBtn" class="swap-btn">
                                <svg viewBox="0 0 24 24" width="20" height="20">
                                    <path fill="currentColor" d="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z" />
                                </svg>
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <div class="input-group">
                                <input type="text" id="resultInput" readonly placeholder="转换结果" class="currency-input">
                                <select id="toCurrency" class="currency-select">
                                    <option value="USD">美元 (USD)</option>
                                    <option value="CNY">人民币 (CNY)</option>
                                    <option value="EUR">欧元 (EUR)</option>
                                    <option value="JPY">日元 (JPY)</option>
                                    <option value="GBP">英镑 (GBP)</option>
                                    <option value="KRW">韩元 (KRW)</option>
                                    <option value="HKD">港币 (HKD)</option>
                                    <option value="AUD">澳元 (AUD)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="currency-actions">
                            <button id="convertBtn" class="convert-btn">转换</button>
                            <button id="copyResultBtn" class="copy-btn">复制结果</button>
                        </div>
                        
                        <div class="exchange-rate-display">
                            <span id="exchangeRateInfo">汇率信息将显示在这里</span>
                        </div>
                        
                        <div id="currencyError" class="error-message"></div>
                    </div>
                    
                    <div class="currency-info" style="visibility: hidden; position: absolute;">
                        <h3>常用汇率参考 (更新于: <span id="rateUpdateTime"></span>)</h3>
                        <div class="rate-grid">
                            <div class="rate-item">
                                <div class="rate-pair">1 USD = <span class="rate-value" id="usd-cny">--</span> CNY</div>
                            </div>
                            <div class="rate-item">
                                <div class="rate-pair">1 EUR = <span class="rate-value" id="eur-cny">--</span> CNY</div>
                            </div>
                            <div class="rate-item">
                                <div class="rate-pair">1 GBP = <span class="rate-value" id="gbp-cny">--</span> CNY</div>
                            </div>
                            <div class="rate-item">
                                <div class="rate-pair">1 CNY = <span class="rate-value" id="cny-jpy">--</span> JPY</div>
                            </div>
                            <div class="rate-item">
                                <div class="rate-pair">1 CNY = <span class="rate-value" id="cny-krw">--</span> KRW</div>
                            </div>
                            <div class="rate-item">
                                <div class="rate-pair">1 CNY = <span class="rate-value" id="cny-hkd">--</span> HKD</div>
                            </div>
                        </div>
                    </div>
                    <!-- 创建一个占位符，与currency-info大小相同，但完全不可见 -->
                    <div class="currency-info-placeholder"></div>
                </div>
                
                <style>
                    div.currency-view {
                        background: linear-gradient(135deg, #0d1114 0%, #1a1f2e 50%, #0d1114 100%);
                        position: relative;
                        overflow: hidden;
                    }
                    
                    div.currency-view::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: 
                            radial-gradient(circle at 20% 20%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                            radial-gradient(circle at 80% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                            radial-gradient(circle at 40% 70%, rgba(0, 212, 255, 0.08) 0%, transparent 50%);
                        animation: backgroundShift 25s ease-in-out infinite;
                        z-index: 0;
                    }

                    .currency-container {
                        padding: 20px;
                        max-width: 900px;
                        margin: 20px auto 0; /* 增加顶部外边距 */
                        color: #00d4ff;
                        height: calc(100% - 46px); /* 减去顶部导航栏的高度 */
                        display: flex;
                        flex-direction: column;
                        justify-content: center; /* 居中布局 */
                        pointer-events: auto; /* 确保点击事件正常工作 */
                        position: relative; /* 确保定位上下文正确 */
                        z-index: 1; /* 调整z-index */
                        width: 100%; /* 确保宽度正确 */
                        opacity: 1; /* 确保默认可见 */
                        transition: opacity 0.3s ease; /* 平滑过渡 */
                        overflow-y: auto; /* 避免内容过多时引起的溢出和抖动 */
                    }
                    
                    /* 移除了section-title相关样式 */
                    
                    .currency-content {
                        display: flex;
                        flex-direction: column;
                        gap: 25px;
                        padding: 40px 0; /* 增加上下内边距，使内容更居中 */
                        margin-top: 20px; /* 向下移动整体内容 */
                        height: auto; /* 自适应高度 */
                        flex: none; /* 确保内容区域不会被挤压或拉伸 */
                        animation: slideInUp 0.6s ease backwards;
                    }
                    
                    .currency-card {
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        border-radius: 12px;
                        padding: 25px;
                        box-shadow: 0 8px 25px rgba(0, 212, 255, 0.2);
                        display: flex;
                        flex-direction: column;
                        gap: 20px;
                        transition: all 0.3s ease;
                    }
                    
                    .currency-card:hover {
                        border-color: #00d4ff;
                        box-shadow: 0 12px 35px rgba(0, 212, 255, 0.3);
                        transform: translateY(-2px);
                    }
                    
                    .form-group {
                        width: 100%;
                    }
                    
                    .input-group {
                        display: flex;
                        gap: 10px;
                        width: 100%;
                    }
                    
                    .currency-input {
                        flex: 1;
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        color: #00d4ff;
                        padding: 12px 16px;
                        border-radius: 8px;
                        font-size: 16px;
                        transition: all 0.3s ease;
                    }
                    
                    .currency-input:focus {
                        border-color: #00d4ff;
                        box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
                        outline: none;
                        background: rgba(15, 21, 26, 0.9);
                    }
                    
                    .currency-select {
                        width: 160px;
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        color: #00d4ff;
                        padding: 12px;
                        border-radius: 8px;
                        font-size: 15px;
                        appearance: none;
                        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2300d4ff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
                        background-repeat: no-repeat;
                        background-position: right 12px center;
                        padding-right: 35px;
                        transition: all 0.3s ease;
                    }
                    
                    .currency-select:focus {
                        border-color: #00d4ff;
                        box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
                        outline: none;
                        background: rgba(15, 21, 26, 0.9);
                    }
                    
                    .swap-btn-container {
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        padding: 5px 0;
                    }
                    
                    .swap-btn {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        width: 40px;
                        height: 40px;
                        background: linear-gradient(135deg, #00d4ff, #0ea5e9);
                        color: white;
                        border: none;
                        border-radius: 50%;
                        cursor: pointer;
                        box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .swap-btn::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
                        transition: left 0.5s ease;
                    }
                    
                    .swap-btn:hover::before {
                        left: 100%;
                    }
                    
                    .swap-btn:hover {
                        transform: scale(1.1) rotate(180deg);
                        box-shadow: 0 6px 20px rgba(0, 212, 255, 0.5);
                    }
                    
                    .swap-btn svg {
                        transform: rotate(90deg);
                    }
                    
                    .currency-actions {
                        display: flex;
                        gap: 12px;
                        animation: slideInUp 0.6s ease backwards;
                        animation-delay: 0.2s;
                    }
                    
                    .convert-btn, .copy-btn {
                        flex: 1;
                        background: linear-gradient(135deg, #00d4ff, #0ea5e9);
                        color: white;
                        border: none;
                        padding: 12px 16px;
                        border-radius: 8px;
                        font-size: 15px;
                        font-weight: 500;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .convert-btn::before, .copy-btn::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
                        transition: left 0.5s ease;
                    }
                    
                    .convert-btn:hover::before, .copy-btn:hover::before {
                        left: 100%;
                    }
                    
                    .convert-btn:hover, .copy-btn:hover {
                        box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
                        transform: translateY(-2px);
                    }
                    
                    .exchange-rate-display {
                        background: rgba(0, 212, 255, 0.05);
                        border: 1px solid rgba(0, 212, 255, 0.2);
                        border-radius: 8px;
                        padding: 12px;
                        font-size: 14px;
                        color: #00d4ff;
                        text-align: center;
                        text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
                    }
                    
                    .error-message {
                        color: #ff6b6b;
                        font-size: 14px;
                        min-height: 20px;
                        display: none;
                        background: rgba(255, 107, 107, 0.1);
                        padding: 6px 10px;
                        border-radius: 6px;
                        border-left: 3px solid #ff6b6b;
                        text-shadow: 0 0 8px rgba(255, 107, 107, 0.3);
                    }
                    
                    .currency-info {
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        border-radius: 12px;
                        padding: 25px;
                        margin-top: 5px;
                        will-change: opacity, transform; /* 优化渲染性能 */
                        box-shadow: 0 8px 25px rgba(0, 212, 255, 0.2);
                        transition: all 0.3s ease;
                        animation: slideInUp 0.6s ease backwards;
                        animation-delay: 0.3s;
                    }
                    
                    .currency-info:hover {
                        border-color: #00d4ff;
                        box-shadow: 0 12px 35px rgba(0, 212, 255, 0.3);
                    }
                    
                    /* 创建一个占位符以保持布局 */
                    .currency-info-placeholder {
                        height: 280px; /* 更准确的占位高度，减少重排 */
                        margin-top: 5px;
                        visibility: hidden;
                        flex: none; /* 防止弹性布局影响 */
                    }
                    
                    .currency-info h3 {
                        font-size: 16px;
                        margin-bottom: 20px;
                        color: #00d4ff;
                        font-weight: 500;
                        text-align: center;
                        text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
                    }
                    
                    .rate-grid {
                        display: grid;
                        grid-template-columns: repeat(3, 1fr);
                        gap: 20px;
                        max-width: 800px;
                        margin: 0 auto;
                    }
                    
                    .rate-item {
                        background: rgba(0, 212, 255, 0.05);
                        border: 1px solid rgba(0, 212, 255, 0.2);
                        padding: 15px;
                        border-radius: 8px;
                        text-align: center;
                        box-shadow: 0 4px 12px rgba(0, 212, 255, 0.1);
                        transition: all 0.3s ease;
                        animation: slideInUp 0.6s ease backwards;
                    }
                    
                    .rate-item:nth-child(1) { animation-delay: 0.4s; }
                    .rate-item:nth-child(2) { animation-delay: 0.5s; }
                    .rate-item:nth-child(3) { animation-delay: 0.6s; }
                    .rate-item:nth-child(4) { animation-delay: 0.7s; }
                    .rate-item:nth-child(5) { animation-delay: 0.8s; }
                    .rate-item:nth-child(6) { animation-delay: 0.9s; }
                    
                    .rate-item:hover {
                        border-color: #00d4ff;
                        box-shadow: 0 6px 18px rgba(0, 212, 255, 0.2);
                        transform: translateY(-2px);
                    }
                    
                    .rate-pair {
                        font-size: 15px;
                        line-height: 1.5;
                        letter-spacing: 0.3px;
                        color: #00d4ff;
                    }
                    
                    .rate-value {
                        color: #10b981;
                        font-weight: 600;
                        text-shadow: 0 0 6px rgba(16, 185, 129, 0.4);
                    }
                    
                    @media (max-width: 768px) {
                        .currency-card {
                            padding: 20px;
                        }
                        
                        .currency-select {
                            width: 120px;
                        }
                        
                        .rate-grid {
                            grid-template-columns: repeat(2, 1fr);
                        }
                    }
                    
                    @media (max-width: 480px) {
                        .input-group {
                            flex-direction: column;
                        }
                        
                        .currency-select {
                            width: 100%;
                        }
                        
                        .rate-grid {
                            grid-template-columns: 1fr;
                        }
                    }
                </style>
            </div>`;
        }

        function ensureCurrency() {
            // 创建全新的货币视图元素
            const cv = document.createElement('div');
            cv.className = 'currency-view';
            cv.dataset.key = 'currency';

            // 重要：为视图设置固定高度以防止布局抖动
            cv.style.height = '100%';
            cv.style.position = 'absolute';
            cv.style.inset = '0';
            cv.style.overflow = 'auto';

            document.querySelector('main').appendChild(cv);

            // 先将视图设为透明，避免闪烁
            cv.style.opacity = '0';
            cv.innerHTML = buildCurrencyHTML();

            // 确保货币转换视图不会捕获本应传递给导航栏按钮的点击事件
            cv.addEventListener('click', (e) => {
                // 只在点击货币转换视图内的元素时阻止冒泡
                if (e.target.closest('.currency-card') ||
                    e.target.closest('.currency-info') ||
                    e.target === cv) {
                    // 不做任何阻止，让事件继续冒泡
                }
            });

            // 初始化货币转换功能
            wireCurrency(cv);

            // 确保DOM完全渲染后再显示，使用setTimeout而不是requestAnimationFrame
            // 因为requestAnimationFrame可能在元素大小计算完成前执行
            setTimeout(() => {
                cv.style.opacity = '1';
                cv.style.transition = 'opacity 0.3s ease';
            }, 50);

            return cv;
        } function buildCurlHTML() {
            return `<div class="curl-container">
                <div class="curl-content">
                    <div class="curl-card">
                        <div class="curl-header">
                            <div class="curl-title">CURL 请求工具</div>
                            <div class="curl-tabs">
                                <button id="getTab" class="curl-tab-btn active">GET</button>
                                <button id="postTab" class="curl-tab-btn">POST</button>
                            </div>
                        </div>
                        
                        <div class="curl-section">
                            <div class="curl-label">URL</div>
                            <div class="curl-url-container">
                                <input type="text" id="curlUrl" placeholder="https://example.com/api" class="curl-input">
                                <button id="historyBtn" class="curl-history-btn" title="查看历史记录">
                                    <span>⌚</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="curl-section" id="headerSection">
                            <div class="curl-label">
                                <span>请求头</span>
                                <button id="addHeaderBtn" class="curl-add-btn">添加</button>
                            </div>
                            <div id="headersContainer" class="headers-container">
                                <div class="header-item">
                                    <input type="text" class="curl-input header-name" placeholder="名称">
                                    <input type="text" class="curl-input header-value" placeholder="值">
                                    <button class="curl-remove-btn">删除</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="curl-section" id="bodySection" style="display: none;">
                            <div class="curl-label">请求体</div>
                            <div class="body-type-selector">
                                <select id="bodyTypeSelect" class="curl-select">
                                    <option value="json">JSON</option>
                                    <option value="form">表单数据</option>
                                    <option value="raw">Raw</option>
                                </select>
                            </div>
                            <div id="jsonBody" class="body-content">
                                <textarea id="jsonBodyInput" class="curl-textarea" placeholder='{"key": "value"}'></textarea>
                            </div>
                            <div id="formBody" class="body-content" style="display: none;">
                                <div id="formDataContainer">
                                    <div class="form-data-item">
                                        <input type="text" class="curl-input form-key" placeholder="键">
                                        <input type="text" class="curl-input form-value" placeholder="值">
                                        <button class="curl-remove-btn">删除</button>
                                    </div>
                                </div>
                                <button id="addFormDataBtn" class="curl-add-btn">添加表单项</button>
                            </div>
                            <div id="rawBody" class="body-content" style="display: none;">
                                <textarea id="rawBodyInput" class="curl-textarea" placeholder="输入原始请求体数据"></textarea>
                            </div>
                        </div>
                        
                        <div class="curl-actions">
                            <button id="sendRequestBtn" class="curl-send-btn">发送请求</button>
                            <button id="clearBtn" class="curl-clear-btn">清空</button>
                        </div>
                        
                        <div id="curlError" class="error-message"></div>
                    </div>
                    
                    <div class="curl-response">
                        <div class="curl-response-header">
                            <div class="curl-label">响应结果</div>
                            <div class="curl-response-actions">
                                <span id="responseStatus" class="response-status"></span>
                                <span id="responseTime" class="response-time"></span>
                                <button id="copyResponseBtn" class="curl-copy-btn">复制</button>
                            </div>
                                <div id="responseContentType" style="margin-top:4px;color:#aaa;font-size:13px;">内容类型: -</div>
                        </div>
                        <div class="curl-response-tabs">
                            <button id="responseTab" class="curl-resp-tab-btn active">响应体</button>
                            <button id="headersTab" class="curl-resp-tab-btn">响应头</button>
                            <button id="requestInfoTab" class="curl-resp-tab-btn">请求信息</button>
                        </div>
                        <div id="responseBody" class="curl-response-content">
                            <pre id="responseBodyContent" class="response-body-content">请先发送请求...</pre>
                        </div>
                        <div id="responseHeaders" class="curl-response-content" style="display: none;">
                            <pre id="responseHeadersContent" class="response-headers-content">请先发送请求...</pre>
                        </div>
                        <div id="requestInfo" class="curl-response-content" style="display: none;">
                            <pre id="requestInfoContent" class="request-info-content">请先发送请求...</pre>
                        </div>
                    </div>
                </div>
                
                <style>
                    div.curl-view {
                        background: linear-gradient(135deg, #0d1114 0%, #1a1f2e 50%, #0d1114 100%);
                        position: relative;
                        overflow: hidden;
                    }
                    
                    div.curl-view::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: 
                            radial-gradient(circle at 20% 20%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                            radial-gradient(circle at 80% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                            radial-gradient(circle at 40% 70%, rgba(0, 212, 255, 0.08) 0%, transparent 50%);
                        animation: backgroundShift 25s ease-in-out infinite;
                        z-index: 0;
                    }

                    .curl-container {
                        padding: 20px;
                        max-width: 95%; /* 更改为百分比宽度，以适应更大的屏幕 */
                        margin: 0 auto;
                        color: #00d4ff;
                        height: calc(100% - 46px); /* 减去顶部导航栏的高度 */
                        display: flex;
                        flex-direction: column;
                        pointer-events: auto; /* 确保点击事件正常工作 */
                        position: relative; /* 确保定位上下文正确 */
                        z-index: 1; /* 调整z-index */
                        width: 100%; /* 确保宽度正确 */
                    }
                    
                    .curl-content {
                        display: flex;
                        height: 100%;
                        gap: 20px;
                        animation: slideInUp 0.6s ease backwards;
                    }
                    
                    .curl-card {
                        flex: 1;
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        border-radius: 12px;
                        padding: 20px;
                        display: flex;
                        flex-direction: column;
                        gap: 15px;
                        overflow-y: auto;
                        box-shadow: 0 8px 25px rgba(0, 212, 255, 0.2);
                        transition: all 0.3s ease;
                    }
                    
                    .curl-card:hover {
                        border-color: #00d4ff;
                        box-shadow: 0 12px 35px rgba(0, 212, 255, 0.3);
                    }
                    
                    .curl-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        border-bottom: 1px solid rgba(0, 212, 255, 0.3);
                        padding-bottom: 12px;
                        margin-bottom: 5px;
                    }
                    
                    .curl-title {
                        font-size: 18px;
                        font-weight: 600;
                        color: #00d4ff;
                        text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
                    }
                    
                    .curl-tabs {
                        display: flex;
                        gap: 10px;
                    }
                    
                    .curl-tab-btn {
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        padding: 6px 14px;
                        border-radius: 6px;
                        color: #00d4ff;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .curl-tab-btn::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                        transition: left 0.5s ease;
                    }
                    
                    .curl-tab-btn:hover::before {
                        left: 100%;
                    }
                    
                    .curl-tab-btn:hover {
                        background: rgba(0, 212, 255, 0.1);
                        border-color: #00d4ff;
                        box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
                    }
                    
                    .curl-tab-btn.active {
                        background: linear-gradient(135deg, #00d4ff, #0ea5e9);
                        border-color: #00d4ff;
                        color: white;
                        box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
                        text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
                    }
                    
                    .curl-tab-btn:hover:not(.active) {
                        background: #334155;
                    }
                    
                    .curl-section {
                        display: flex;
                        flex-direction: column;
                        gap: 8px;
                        animation: slideInUp 0.6s ease backwards;
                    }
                    
                    .curl-section:nth-child(2) { animation-delay: 0.1s; }
                    .curl-section:nth-child(3) { animation-delay: 0.2s; }
                    .curl-section:nth-child(4) { animation-delay: 0.3s; }
                    
                    .curl-label {
                        font-size: 14px;
                        font-weight: 500;
                        color: #00d4ff;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
                    }
                    
                    .curl-input {
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        border-radius: 6px;
                        padding: 8px 12px;
                        color: #00d4ff;
                        width: 100%;
                        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
                        transition: all 0.3s ease;
                    }
                    
                    .curl-input:focus {
                        border-color: #00d4ff;
                        outline: none;
                        box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
                        background: rgba(15, 21, 26, 0.9);
                    }
                    
                    /* URL输入框容器 */
                    .curl-url-container {
                        display: flex;
                        align-items: center;
                        width: 100%;
                        position: relative;
                    }
                    
                    /* 历史按钮样式 */
                    .curl-history-btn {
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        color: #00d4ff;
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        width: 36px;
                        height: 36px;
                        border-radius: 6px;
                        margin-left: 8px;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .curl-history-btn::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                        transition: left 0.5s ease;
                    }
                    
                    .curl-history-btn:hover::before {
                        left: 100%;
                    }
                    
                    .curl-history-btn:hover {
                        background: rgba(0, 212, 255, 0.1);
                        border-color: #00d4ff;
                        color: #ffffff;
                        box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
                        transform: scale(1.05);
                    }
                        color: #e5e7eb;
                    }
                    
                    /* 历史记录浮层 */
                    .curl-history-float {
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: #1f2937;
                        border: 1px solid #374151;
                        border-radius: 8px;
                        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
                        z-index: 1000;
                        width: 500px;
                        max-width: 90vw;
                        max-height: 80vh;
                        display: flex;
                        flex-direction: column;
                        overflow: hidden;
                        animation: fadeIn 0.3s ease-out;
                    }
                    
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translate(-50%, -48%); }
                        to { opacity: 1; transform: translate(-50%, -50%); }
                    }
                    
                    .curl-history-float-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 12px 16px;
                        border-bottom: 1px solid #374151;
                        background: #111827;
                    }
                    
                    .curl-history-float-title {
                        font-size: 16px;
                        font-weight: 600;
                        color: #e5e7eb;
                    }
                    
                    .curl-history-float-actions {
                        display: flex;
                        align-items: center;
                    }
                    
                    .curl-history-float-close {
                        background: none;
                        border: none;
                        color: #9ca3af;
                        font-size: 24px;
                        line-height: 1;
                        cursor: pointer;
                        padding: 0 4px;
                    }
                    
                    .curl-history-float-close:hover {
                        color: #e5e7eb;
                    }
                    
                    .curl-history-float-body {
                        flex: 1;
                        overflow: hidden;
                        display: flex;
                        flex-direction: column;
                    }
                    
                    .curl-history-float-toolbar {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 8px 16px;
                        border-bottom: 1px solid #374151;
                    }
                    
                    .curl-history-count-badge {
                        background: #2563eb;
                        color: white;
                        padding: 2px 8px;
                        border-radius: 12px;
                        font-size: 12px;
                    }
                    
                    .curl-history-clear-btn {
                        background: #1e293b;
                        color: #9ca3af;
                        border: none;
                        padding: 4px 8px;
                        border-radius: 4px;
                        font-size: 12px;
                        cursor: pointer;
                    }
                    
                    .curl-history-clear-btn:hover {
                        background: #2d3748;
                        color: #e5e7eb;
                    }
                    
                    .curl-history-list {
                        flex: 1;
                        overflow-y: auto;
                        padding: 8px 0;
                    }
                    
                    .curl-history-item {
                        padding: 12px 16px;
                        border-bottom: 1px solid #374151;
                        cursor: pointer;
                        color: #e5e7eb;
                        transition: all 0.2s;
                    }
                    
                    .curl-history-item:hover {
                        background: #2d3748;
                    }
                    
                    .curl-history-item:active {
                        background: #374151;
                    }
                    
                    .curl-history-item .history-url {
                        font-weight: 600;
                        color: #60a5fa;
                        margin-bottom: 6px;
                        white-space: nowrap;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }
                    
                    .curl-history-item .history-status {
                        display: inline-block;
                        padding: 2px 6px;
                        border-radius: 4px;
                        font-size: 12px;
                        margin-right: 8px;
                        color: white;
                    }
                    
                    .curl-history-item .history-status.success {
                        background: #10b981; /* 绿色 */
                    }
                    
                    .curl-history-item .history-status.error {
                        background: #ef4444; /* 红色 */
                    }
                    
                    .curl-history-item .history-info-row {
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        margin-top: 4px;
                    }
                    
                    .curl-history-item .history-left {
                        display: flex;
                        align-items: center;
                    }
                    
                    .curl-history-item .history-method {
                        display: inline-block;
                        padding: 2px 6px;
                        border-radius: 4px;
                        font-size: 12px;
                        margin-right: 8px;
                        color: white;
                        font-weight: 500;
                    }
                    
                    /* GET方法标签样式 */
                    .curl-history-item .history-method.get {
                        background: #0369a1; /* 蓝色 */
                    }
                    
                    /* POST方法标签样式 */
                    .curl-history-item .history-method.post {
                        background: #15803d; /* 绿色 */
                    }
                    
                    .curl-history-item .history-time {
                        font-size: 12px;
                        color: #9ca3af;
                    }
                    
                    .curl-history-item .history-actions {
                        display: flex;
                        gap: 8px;
                        opacity: 0;
                        transition: opacity 0.2s;
                    }
                    
                    .curl-history-item:hover .history-actions {
                        opacity: 1;
                    }
                    
                    .curl-history-item .history-action-btn {
                        background: none;
                        border: none;
                        color: #9ca3af;
                        cursor: pointer;
                        padding: 2px;
                        font-size: 14px;
                    }
                    
                    .curl-history-item .history-action-btn:hover {
                        color: #e5e7eb;
                    }
                    
                    .curl-history-empty {
                        padding: 24px;
                        text-align: center;
                        color: #9ca3af;
                        font-style: italic;
                    }
                    }
                    
                    .curl-textarea {
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        border-radius: 6px;
                        padding: 10px;
                        color: #00d4ff;
                        width: 100%;
                        min-height: 120px;
                        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
                        resize: vertical;
                        transition: all 0.3s ease;
                    }
                    
                    .curl-textarea:focus {
                        border-color: #00d4ff;
                        outline: none;
                        box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
                        background: rgba(15, 21, 26, 0.9);
                    }
                    
                    .curl-select {
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        border-radius: 6px;
                        padding: 8px 12px;
                        color: #00d4ff;
                        width: 100%;
                        transition: all 0.3s ease;
                    }
                    
                    .curl-select:focus {
                        border-color: #00d4ff;
                        outline: none;
                        box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
                        background: rgba(15, 21, 26, 0.9);
                    }
                    
                    .headers-container, #formDataContainer {
                        display: flex;
                        flex-direction: column;
                        gap: 8px;
                    }
                    
                    .header-item, .form-data-item {
                        display: flex;
                        gap: 8px;
                    }
                    
                    .header-name, .header-value, .form-key, .form-value {
                        flex: 1;
                    }
                    
                    .curl-add-btn {
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        color: #00d4ff;
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        padding: 4px 8px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 12px;
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .curl-add-btn::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                        transition: left 0.5s ease;
                    }
                    
                    .curl-add-btn:hover::before {
                        left: 100%;
                    }
                    
                    .curl-add-btn:hover {
                        background: rgba(0, 212, 255, 0.1);
                        border-color: #00d4ff;
                        box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
                    }
                    
                    .curl-remove-btn {
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        color: #ff6b6b;
                        border: 1px solid rgba(255, 107, 107, 0.3);
                        padding: 0 8px;
                        border-radius: 4px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .curl-remove-btn::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                        transition: left 0.5s ease;
                    }
                    
                    .curl-remove-btn:hover::before {
                        left: 100%;
                    }
                    
                    .curl-remove-btn:hover {
                        background: rgba(255, 107, 107, 0.1);
                        border-color: #ff6b6b;
                        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
                    }
                    
                    .body-type-selector {
                        margin-bottom: 10px;
                    }
                    
                    .curl-actions {
                        display: flex;
                        gap: 10px;
                        margin-top: 10px;
                        animation: slideInUp 0.6s ease backwards;
                        animation-delay: 0.4s;
                    }
                    
                    .curl-send-btn {
                        background: linear-gradient(135deg, #00d4ff, #0ea5e9);
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 6px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-weight: 500;
                        box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .curl-send-btn::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
                        transition: left 0.5s ease;
                    }
                    
                    .curl-send-btn:hover::before {
                        left: 100%;
                    }
                    
                    .curl-send-btn:hover {
                        background: linear-gradient(135deg, #0ea5e9, #0284c7);
                        box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
                        transform: translateY(-2px);
                    }
                    
                    .curl-clear-btn {
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        color: #00d4ff;
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        padding: 8px 16px;
                        border-radius: 6px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .curl-clear-btn::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                        transition: left 0.5s ease;
                    }
                    
                    .curl-clear-btn:hover::before {
                        left: 100%;
                    }
                    
                    .curl-clear-btn:hover {
                        background: rgba(0, 212, 255, 0.1);
                        border-color: #00d4ff;
                        box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
                        transform: translateY(-1px);
                    }
                    
                    .curl-response {
                        flex: 1;
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        border-radius: 12px;
                        padding: 20px;
                        display: flex;
                        flex-direction: column;
                        overflow: hidden;
                        box-shadow: 0 8px 25px rgba(0, 212, 255, 0.2);
                        transition: all 0.3s ease;
                        animation: slideInRight 0.6s ease backwards;
                        animation-delay: 0.2s;
                    }
                    
                    .curl-response:hover {
                        border-color: #00d4ff;
                        box-shadow: 0 12px 35px rgba(0, 212, 255, 0.3);
                    }
                    
                    .curl-response-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        border-bottom: 1px solid #2d3748;
                        padding-bottom: 12px;
                        margin-bottom: 5px;
                    }
                    
                    .curl-response-actions {
                        display: flex;
                        align-items: center;
                        gap: 12px;
                    }
                    
                    .response-status {
                        padding: 3px 8px;
                        border-radius: 10px;
                        font-size: 12px;
                        font-weight: 500;
                    }
                    
                    .response-status.success {
                        background: rgba(16, 185, 129, 0.2);
                        color: #34d399;
                    }
                    
                    .response-status.error {
                        background: rgba(239, 68, 68, 0.2);
                        color: #f87171;
                    }
                    
                    .response-time {
                        font-size: 12px;
                        color: #9ca3af;
                    }
                    
                    .curl-copy-btn {
                        background: #1e293b;
                        color: #9ca3af;
                        border: none;
                        padding: 4px 8px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 12px;
                    }
                    
                    .curl-copy-btn:hover {
                        background: #2d3748;
                        color: #e5e7eb;
                    }
                    
                    .curl-response-tabs {
                        display: flex;
                        gap: 10px;
                        margin: 10px 0;
                    }
                    
                    .curl-resp-tab-btn {
                        background: rgba(15, 21, 26, 0.8);
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(0, 212, 255, 0.3);
                        padding: 6px 14px;
                        border-radius: 6px;
                        color: #00d4ff;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-size: 13px;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .curl-resp-tab-btn::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: -100%;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                        transition: left 0.5s ease;
                    }
                    
                    .curl-resp-tab-btn:hover::before {
                        left: 100%;
                    }
                    
                    .curl-resp-tab-btn.active {
                        background: linear-gradient(135deg, #00d4ff, #0ea5e9);
                        border-color: #00d4ff;
                        color: white;
                        box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
                        text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
                    }
                    
                    .curl-resp-tab-btn:hover:not(.active) {
                        background: rgba(0, 212, 255, 0.1);
                        border-color: #00d4ff;
                        box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
                    }
                    
                    .curl-response-content {
                        flex: 1;
                        overflow: auto;
                        background: rgba(0, 212, 255, 0.05);
                        border: 1px solid rgba(0, 212, 255, 0.2);
                        border-radius: 6px;
                        padding: 10px;
                        transition: all 0.3s ease;
                        backdrop-filter: blur(10px);
                    }
                    
                    .curl-response-content:hover {
                        border-color: rgba(0, 212, 255, 0.4);
                        box-shadow: 0 4px 12px rgba(0, 212, 255, 0.1);
                    }
                    
                    .response-body-content, .response-headers-content {
                        color: #00d4ff;
                        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
                        font-size: 13px;
                        line-height: 1.5;
                        margin: 0;
                        white-space: pre-wrap;
                        word-break: break-word;
                        text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
                    }
                    
                    .error-message {
                        color: #ff6b6b;
                        font-size: 13px;
                        display: none;
                        text-shadow: 0 0 8px rgba(255, 107, 107, 0.3);
                        background: rgba(255, 107, 107, 0.1);
                        border: 1px solid rgba(255, 107, 107, 0.2);
                        border-radius: 6px;
                        padding: 8px 12px;
                        margin-top: 10px;
                    }
                    
                    /* 响应式调整 */
                    @media (max-width: 768px) {
                        .curl-content {
                            flex-direction: column;
                        }
                        
                        .curl-card, .curl-response {
                            max-height: 500px;
                        }
                    }
                </style>
            `;
        }

        function ensureCurl() {
            let cv = document.querySelector('div.curl-view[data-key="curl"]');
            if (!cv) {
                cv = document.createElement('div');
                cv.className = 'curl-view';
                cv.dataset.key = 'curl';
                document.querySelector('main').appendChild(cv);
            }
            cv.innerHTML = buildCurlHTML();

            wireCurl(cv);
            return cv;
        }

        function wireCurl(container) {
            // 历史记录管理
            const HISTORY_KEY = 'curl_request_history';
            const MAX_HISTORY = 20;

            // 测试localStorage是否可用
            function isLocalStorageAvailable() {
                const testKey = '_test_localStorage';
                try {
                    localStorage.setItem(testKey, testKey);
                    localStorage.removeItem(testKey);
                    return true;
                } catch (e) {
                    return false;
                }
            }

            // 内存中的历史记录备份，以防localStorage不可用
            let inMemoryHistory = [];

            // 从LocalStorage加载历史记录
            function loadHistory() {
                try {
                    if (!isLocalStorageAvailable()) {
                        console.log('localStorage不可用，使用内存历史记录');
                        return inMemoryHistory;
                    }

                    const history = localStorage.getItem(HISTORY_KEY);
                    console.log('Raw history from localStorage:', history);

                    if (history) {
                        const parsedHistory = JSON.parse(history);
                        inMemoryHistory = parsedHistory; // 同步内存历史记录
                        return parsedHistory;
                    } else {
                        return [];
                    }
                } catch (error) {
                    console.error('加载历史记录失败:', error);
                    return inMemoryHistory; // 使用内存中的备份
                }
            }

            // 保存历史记录到LocalStorage
            function saveHistory(history) {
                try {
                    inMemoryHistory = history; // 始终更新内存中的历史记录
                    console.log('保存历史记录:', history);

                    if (!isLocalStorageAvailable()) {
                        console.log('localStorage不可用，只保存到内存');
                        return;
                    }

                    localStorage.setItem(HISTORY_KEY, JSON.stringify(history));

                    // 验证保存结果
                    const savedData = localStorage.getItem(HISTORY_KEY);
                    if (!savedData) {
                        console.error('保存历史记录验证失败: 无法读取保存的数据');
                    }
                } catch (error) {
                    console.error('保存历史记录失败:', error);
                }
            }            // 添加一条新的历史记录
            function addHistory(request) {
                const history = loadHistory();

                // 检查是否已有相同的请求（相同的URL和方法）
                const existingIndex = history.findIndex(item =>
                    item.url === request.url &&
                    item.method === request.method
                );

                // 如果存在，删除旧的
                if (existingIndex !== -1) {
                    history.splice(existingIndex, 1);
                }

                // 添加到开头
                history.unshift(request);

                // 如果超过最大数量，删除多余的
                if (history.length > MAX_HISTORY) {
                    history.splice(MAX_HISTORY);
                }

                saveHistory(history);

                // 更新UI
                updateHistoryUI();
            }

            // 清空历史记录
            function clearHistory() {
                localStorage.removeItem(HISTORY_KEY);
                updateHistoryUI();
            }

            // 更新历史记录UI
            function updateHistoryUI() {
                const historyList = document.getElementById('historyList');
                const history = loadHistory();

                historyList.innerHTML = '';

                if (history.length === 0) {
                    historyList.innerHTML = '<div class="curl-history-empty">暂无历史记录</div>';
                    return;
                }

                history.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'curl-history-item';

                    // 添加状态标识（如果有）
                    const statusClass = item.status ?
                        (item.status >= 200 && item.status < 300 ? 'success' : 'error') : '';

                    historyItem.innerHTML = `
                        <div class="history-url">
                            ${item.status ? `<span class="history-status ${statusClass}">${item.status}</span>` : ''}
                            ${item.url}
                        </div>
                        <div class="history-info-row">
                            <div class="history-left">
                                <span class="history-method ${item.method.toLowerCase()}">${item.method}</span>
                                <span class="history-time">${item.time || '未知时间'}</span>
                            </div>
                            <div class="history-actions">
                                <button class="history-action-btn history-action-delete" title="删除这条记录">🗑️</button>
                            </div>
                        </div>
                    `;

                    // 点击加载历史记录
                    historyItem.addEventListener('click', (e) => {
                        // 如果点击的是删除按钮，则不加载记录
                        if (e.target.classList.contains('history-action-delete') ||
                            e.target.closest('.history-action-delete')) {
                            e.stopPropagation();

                            // 删除该条记录
                            const history = loadHistory();
                            history.splice(index, 1);
                            saveHistory(history);
                            updateHistoryUI();
                            updateHistoryCount();
                            return;
                        }

                        loadHistoryItem(item);
                        historyFloatPanel.style.display = 'none';
                    });

                    historyList.appendChild(historyItem);
                });
            }

            // 加载历史记录到表单
            function loadHistoryItem(item) {
                console.log('加载历史记录项:', item);
                const curlUrl = container.querySelector('#curlUrl');

                // 设置URL（使用原始输入URL）
                curlUrl.value = item.url || '';

                // 选择对应的请求方法
                if (item.method === 'GET') {
                    getTab.click();
                } else if (item.method === 'POST') {
                    postTab.click();

                    // 设置请求体
                    if (item.bodyType) {
                        const bodyTypeSelect = container.querySelector('#bodyTypeSelect');
                        bodyTypeSelect.value = item.bodyType;
                        bodyTypeSelect.dispatchEvent(new Event('change'));

                        // 根据不同的body类型设置值
                        if (item.bodyType === 'json' && item.body) {
                            container.querySelector('#jsonBodyInput').value = item.body;
                        } else if (item.bodyType === 'raw' && item.body) {
                            container.querySelector('#rawBodyInput').value = item.body;
                        } else if (item.bodyType === 'form' && Array.isArray(item.formData)) {
                            // 清除现有表单项
                            const formContainer = container.querySelector('#formDataContainer');
                            formContainer.innerHTML = '';

                            // 添加表单项
                            item.formData.forEach(formItem => {
                                const newFormItem = document.createElement('div');
                                newFormItem.className = 'form-data-item';
                                newFormItem.innerHTML = `
                                    <input type="text" class="curl-input form-key" placeholder="名称" value="${formItem.key || ''}">
                                    <input type="text" class="curl-input form-value" placeholder="值" value="${formItem.value || ''}">
                                    <button class="curl-remove-btn">删除</button>
                                `;

                                // 添加删除按钮事件
                                const removeBtn = newFormItem.querySelector('.curl-remove-btn');
                                removeBtn.addEventListener('click', () => {
                                    newFormItem.remove();
                                });

                                formContainer.appendChild(newFormItem);
                            });
                        }
                    }
                }

                // 设置请求头
                if (item.headers && Object.keys(item.headers).length > 0) {
                    const headersContainer = container.querySelector('#headersContainer');

                    // 清除现有的请求头
                    headersContainer.innerHTML = '';

                    // 添加历史记录中的请求头
                    Object.entries(item.headers).forEach(([name, value]) => {
                        // 跳过内部生成的请求头（例如 Content-Type 可能由fetch自动添加）
                        if (!name || name === '') return;

                        const headerItem = document.createElement('div');
                        headerItem.className = 'header-item';
                        headerItem.innerHTML = `
                            <input type="text" class="curl-input header-name" placeholder="名称" value="${name}">
                            <input type="text" class="curl-input header-value" placeholder="值" value="${value}">
                            <button class="curl-remove-btn">删除</button>
                        `;

                        // 添加删除按钮事件
                        const removeBtn = headerItem.querySelector('.curl-remove-btn');
                        removeBtn.addEventListener('click', () => {
                            headerItem.remove();
                        });

                        headersContainer.appendChild(headerItem);
                    });

                    // 如果没有添加任何请求头，添加一个空的请求头输入框
                    if (headersContainer.children.length === 0) {
                        const emptyHeaderItem = document.createElement('div');
                        emptyHeaderItem.className = 'header-item';
                        emptyHeaderItem.innerHTML = `
                            <input type="text" class="curl-input header-name" placeholder="名称">
                            <input type="text" class="curl-input header-value" placeholder="值">
                            <button class="curl-remove-btn">删除</button>
                        `;

                        const removeBtn = emptyHeaderItem.querySelector('.curl-remove-btn');
                        removeBtn.addEventListener('click', () => {
                            emptyHeaderItem.remove();
                        });

                        headersContainer.appendChild(emptyHeaderItem);
                    }
                }
            }            // Tab切换
            const getTab = container.querySelector('#getTab');
            const postTab = container.querySelector('#postTab');
            const bodySection = container.querySelector('#bodySection');

            getTab.addEventListener('click', () => {
                getTab.classList.add('active');
                postTab.classList.remove('active');
                bodySection.style.display = 'none';
            });

            postTab.addEventListener('click', () => {
                postTab.classList.add('active');
                getTab.classList.remove('active');
                bodySection.style.display = 'flex';
            });

            // 历史记录按钮和浮层
            const historyBtn = container.querySelector('#historyBtn');
            const historyFloatPanel = document.getElementById('historyFloatPanel');
            const historyFloatClose = document.getElementById('historyFloatClose');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const historyCountBadge = document.getElementById('historyCountBadge');

            // 更新历史记录数量徽章
            function updateHistoryCount() {
                const history = loadHistory();
                historyCountBadge.textContent = history.length;
            }

            // 点击历史按钮显示浮层
            historyBtn.addEventListener('click', () => {
                // 更新历史记录UI
                updateHistoryUI();
                updateHistoryCount();

                // 显示浮层
                historyFloatPanel.style.display = 'flex';

                // 打印历史记录到控制台，方便调试
                console.log('当前历史记录:', loadHistory());

                // 添加ESC键关闭功能
                function handleEscKey(e) {
                    if (e.key === 'Escape') {
                        historyFloatPanel.style.display = 'none';
                        document.removeEventListener('keydown', handleEscKey);
                    }
                }

                document.addEventListener('keydown', handleEscKey);
            });

            // 点击关闭按钮
            historyFloatClose.addEventListener('click', () => {
                historyFloatPanel.style.display = 'none';
            });

            // 点击浮层外部区域关闭
            historyFloatPanel.addEventListener('click', (e) => {
                if (e.target === historyFloatPanel) {
                    historyFloatPanel.style.display = 'none';
                }
            });

            // 清空历史记录
            clearHistoryBtn.addEventListener('click', (e) => {
                e.stopPropagation();

                // 添加确认提示
                if (confirm('确定要清空所有历史记录吗？')) {
                    clearHistory();
                    updateHistoryCount();
                }
            });

            // 拖动浮层
            const historyFloatHeader = historyFloatPanel.querySelector('.curl-history-float-header');
            let isDragging = false;
            let offsetX, offsetY;

            historyFloatHeader.addEventListener('mousedown', (e) => {
                // 如果点击的是关闭按钮，不启动拖拽
                if (e.target === historyFloatClose) return;

                isDragging = true;

                // 计算鼠标点击位置与面板左上角的偏移
                const rect = historyFloatPanel.getBoundingClientRect();
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;

                // 添加鼠标样式
                historyFloatHeader.style.cursor = 'grabbing';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                // 计算新位置
                const x = e.clientX - offsetX;
                const y = e.clientY - offsetY;

                // 更新面板位置
                historyFloatPanel.style.transform = 'none';
                historyFloatPanel.style.left = x + 'px';
                historyFloatPanel.style.top = y + 'px';
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                if (historyFloatHeader) {
                    historyFloatHeader.style.cursor = 'grab';
                }
            });

            // 初始化历史记录UI和计数
            updateHistoryUI();
            updateHistoryCount();

            // 添加请求头
            const addHeaderBtn = container.querySelector('#addHeaderBtn');
            const headersContainer = container.querySelector('#headersContainer');

            addHeaderBtn.addEventListener('click', () => {
                const headerItem = document.createElement('div');
                headerItem.className = 'header-item';
                headerItem.innerHTML = `
                    <input type="text" class="curl-input header-name" placeholder="名称">
                    <input type="text" class="curl-input header-value" placeholder="值">
                    <button class="curl-remove-btn">删除</button>
                `;
                headersContainer.appendChild(headerItem);

                headerItem.querySelector('.curl-remove-btn').addEventListener('click', () => {
                    headerItem.remove();
                });
            });

            // 初始请求头删除按钮
            container.querySelector('#headersContainer .curl-remove-btn').addEventListener('click', (e) => {
                e.target.closest('.header-item').remove();
            });

            // 请求体类型切换
            const bodyTypeSelect = container.querySelector('#bodyTypeSelect');
            const jsonBody = container.querySelector('#jsonBody');
            const formBody = container.querySelector('#formBody');
            const rawBody = container.querySelector('#rawBody');

            bodyTypeSelect.addEventListener('change', () => {
                const selectedValue = bodyTypeSelect.value;

                jsonBody.style.display = 'none';
                formBody.style.display = 'none';
                rawBody.style.display = 'none';

                if (selectedValue === 'json') {
                    jsonBody.style.display = 'block';
                } else if (selectedValue === 'form') {
                    formBody.style.display = 'block';
                } else if (selectedValue === 'raw') {
                    rawBody.style.display = 'block';
                }
            });

            // 添加表单数据项
            const addFormDataBtn = container.querySelector('#addFormDataBtn');
            const formDataContainer = container.querySelector('#formDataContainer');

            addFormDataBtn.addEventListener('click', () => {
                const formItem = document.createElement('div');
                formItem.className = 'form-data-item';
                formItem.innerHTML = `
                    <input type="text" class="curl-input form-key" placeholder="键">
                    <input type="text" class="curl-input form-value" placeholder="值">
                    <button class="curl-remove-btn">删除</button>
                `;
                formDataContainer.appendChild(formItem);

                formItem.querySelector('.curl-remove-btn').addEventListener('click', () => {
                    formItem.remove();
                });
            });

            // 初始表单数据删除按钮
            container.querySelector('#formDataContainer .curl-remove-btn').addEventListener('click', (e) => {
                e.target.closest('.form-data-item').remove();
            });

            // 响应选项卡切换
            const responseTab = container.querySelector('#responseTab');
            const headersTab = container.querySelector('#headersTab');
            const requestInfoTab = container.querySelector('#requestInfoTab');
            const responseBody = container.querySelector('#responseBody');
            const responseHeaders = container.querySelector('#responseHeaders');
            const requestInfo = container.querySelector('#requestInfo');

            function activateTab(activeTab) {
                // 隐藏所有内容
                responseBody.style.display = 'none';
                responseHeaders.style.display = 'none';
                requestInfo.style.display = 'none';

                // 移除所有标签的活动状态
                responseTab.classList.remove('active');
                headersTab.classList.remove('active');
                requestInfoTab.classList.remove('active');

                // 激活选中标签和内容
                activeTab.classList.add('active');

                if (activeTab === responseTab) {
                    responseBody.style.display = 'block';
                } else if (activeTab === headersTab) {
                    responseHeaders.style.display = 'block';
                } else if (activeTab === requestInfoTab) {
                    requestInfo.style.display = 'block';
                }
            }

            responseTab.addEventListener('click', () => activateTab(responseTab));
            headersTab.addEventListener('click', () => activateTab(headersTab));
            requestInfoTab.addEventListener('click', () => activateTab(requestInfoTab));

            // 复制响应
            const copyResponseBtn = container.querySelector('#copyResponseBtn');

            copyResponseBtn.addEventListener('click', () => {
                let content;

                if (responseBody.style.display === 'block') {
                    content = container.querySelector('#responseBodyContent').textContent;
                } else if (responseHeaders.style.display === 'block') {
                    content = container.querySelector('#responseHeadersContent').textContent;
                } else if (requestInfo.style.display === 'block') {
                    content = container.querySelector('#requestInfoContent').textContent;
                }

                navigator.clipboard.writeText(content).then(() => {
                    const originalText = copyResponseBtn.textContent;
                    copyResponseBtn.textContent = '已复制!';
                    setTimeout(() => {
                        copyResponseBtn.textContent = originalText;
                    }, 1500);
                });
            });

            // 清空按钮
            const clearBtn = container.querySelector('#clearBtn');

            clearBtn.addEventListener('click', () => {
                container.querySelector('#curlUrl').value = '';
                container.querySelectorAll('#headersContainer .header-item').forEach((item, index) => {
                    if (index > 0) item.remove(); // 保留第一个头部项
                    else {
                        item.querySelectorAll('input').forEach(input => input.value = '');
                    }
                });

                container.querySelector('#jsonBodyInput').value = '';
                container.querySelectorAll('#formDataContainer .form-data-item').forEach((item, index) => {
                    if (index > 0) item.remove(); // 保留第一个表单项
                    else {
                        item.querySelectorAll('input').forEach(input => input.value = '');
                    }
                });
                container.querySelector('#rawBodyInput').value = '';

                container.querySelector('#responseBodyContent').textContent = '请先发送请求...';
                container.querySelector('#responseHeadersContent').textContent = '请先发送请求...';
                container.querySelector('#requestInfoContent').textContent = '请先发送请求...';

                const statusEl = container.querySelector('#responseStatus');
                statusEl.textContent = '';
                statusEl.className = 'response-status';

                container.querySelector('#responseTime').textContent = '';
                container.querySelector('#curlError').style.display = 'none';
            });

            // 发送请求
            const sendRequestBtn = container.querySelector('#sendRequestBtn');
            const curlUrl = container.querySelector('#curlUrl');
            const curlError = container.querySelector('#curlError');
            const responseStatus = container.querySelector('#responseStatus');
            const responseTime = container.querySelector('#responseTime');
            const responseBodyContent = container.querySelector('#responseBodyContent');
            const responseHeadersContent = container.querySelector('#responseHeadersContent');

            sendRequestBtn.addEventListener('click', async () => {
                // 验证URL
                const url = curlUrl.value.trim();
                if (!url) {
                    curlError.textContent = '请输入有效的URL';
                    curlError.style.display = 'block';
                    return;
                }

                // URL验证更宽松，允许用户输入不带协议的URL（如example.com）
                // 实际发送请求时会自动添加协议

                // 重置错误和状态
                curlError.style.display = 'none';
                responseStatus.textContent = '请求中...';
                responseStatus.className = 'response-status';
                responseTime.textContent = '';
                responseBodyContent.textContent = '加载中...';
                responseHeadersContent.textContent = '加载中...';
                container.querySelector('#requestInfoContent').textContent = '加载中...';

                // 获取请求方法
                const method = getTab.classList.contains('active') ? 'GET' : 'POST';

                // 获取请求头
                const headers = {};
                container.querySelectorAll('#headersContainer .header-item').forEach(item => {
                    const name = item.querySelector('.header-name').value.trim();
                    const value = item.querySelector('.header-value').value.trim();
                    if (name) headers[name] = value;
                });

                // 准备请求体
                let body = null;
                if (method === 'POST') {
                    const bodyType = bodyTypeSelect.value;

                    if (bodyType === 'json') {
                        const jsonValue = container.querySelector('#jsonBodyInput').value.trim();
                        if (jsonValue) {
                            try {
                                // 验证JSON格式
                                JSON.parse(jsonValue);
                                body = jsonValue;
                                if (!headers['Content-Type']) headers['Content-Type'] = 'application/json';
                            } catch (e) {
                                curlError.textContent = 'JSON格式无效';
                                curlError.style.display = 'block';
                                responseBodyContent.textContent = '请先发送请求...';
                                responseHeadersContent.textContent = '请先发送请求...';
                                return;
                            }
                        }
                    } else if (bodyType === 'form') {
                        const formData = new FormData();
                        let hasData = false;

                        container.querySelectorAll('#formDataContainer .form-data-item').forEach(item => {
                            const key = item.querySelector('.form-key').value.trim();
                            const value = item.querySelector('.form-value').value.trim();
                            if (key) {
                                formData.append(key, value);
                                hasData = true;
                            }
                        });

                        if (hasData) {
                            body = formData;
                            // 不需要设置Content-Type，fetch会自动设置为multipart/form-data
                        }
                    } else if (bodyType === 'raw') {
                        const rawValue = container.querySelector('#rawBodyInput').value.trim();
                        if (rawValue) {
                            body = rawValue;
                            if (!headers['Content-Type']) headers['Content-Type'] = 'text/plain';
                        }
                    }
                }

                // 开始计时
                const startTime = Date.now();

                try {
                    // 保存原始输入URL
                    const inputUrl = url;

                    // 创建最终请求URL对象
                    let finalUrl;
                    try {
                        finalUrl = new URL(url);
                        // 确保URL完整
                        if (!finalUrl.protocol) {
                            finalUrl = new URL('https://' + url);
                        }
                    } catch (e) {
                        // 如果URL解析失败，尝试添加https://
                        finalUrl = new URL('https://' + url);
                    }

                    // 将URL转换为字符串
                    const requestUrl = finalUrl.toString();

                    // 发送请求
                    const response = await fetch(requestUrl, {
                        method,
                        headers,
                        body,
                    });

                    // 计算请求时间
                    const endTime = Date.now();
                    const timeTaken = endTime - startTime;
                    responseTime.textContent = `${timeTaken}ms`;

                    // 保存请求到历史记录
                    const historyItem = {
                        url: url, // 使用原始输入的URL
                        actualUrl: response.url, // 保存实际响应URL（可能经过重定向）
                        method,
                        time: new Date().toLocaleString(),
                        headers: headers, // 直接保存headers对象
                        status: response.status,
                    };

                    // 如果是POST请求，保存请求体信息
                    if (method === 'POST' && body) {
                        const bodyTypeSelect = container.querySelector('#bodyTypeSelect');
                        historyItem.bodyType = bodyTypeSelect.value;

                        // 根据不同的请求体类型进行处理
                        if (body instanceof FormData) {
                            historyItem.body = '[FormData]';
                        } else if (typeof body === 'string') {
                            // 尝试解析为JSON，如果不是则保持字符串形式
                            try {
                                const jsonBody = JSON.parse(body);
                                historyItem.body = body;
                            } catch (e) {
                                historyItem.body = body;
                            }
                        }
                    }

                    // 添加到历史记录，并打印日志便于调试
                    console.log('添加历史记录:', historyItem);
                    addHistory(historyItem);

                    // 立即更新历史记录计数
                    try {
                        if (typeof updateHistoryCount === 'function') {
                            updateHistoryCount();
                        }
                    } catch (e) {
                        console.error('更新历史记录计数失败:', e);
                    }                    // 设置状态
                    responseStatus.textContent = `${response.status} ${response.statusText}`;
                    responseStatus.className = `response-status ${response.ok ? 'success' : 'error'}`;

                    // 获取实际请求的URL（可能包含重定向后的URL）
                    const actualUrl = response.url;

                    // 获取响应体
                    const contentType = response.headers.get('content-type');
                    let responseData;
                    let responseType = 'text';

                    // 根据内容类型处理响应
                    if (contentType) {
                        // 显示响应类型
                        container.querySelector('#responseContentType').textContent = `内容类型: ${contentType}`;

                        if (contentType.includes('application/json')) {
                            responseType = 'json';
                            try {
                                responseData = await response.json();
                                responseBodyContent.textContent = JSON.stringify(responseData, null, 2);
                                responseBodyContent.classList.add('json-response');
                            } catch (e) {
                                responseData = await response.text();
                                responseBodyContent.textContent = responseData;
                                responseBodyContent.classList.remove('json-response');
                            }
                        } else if (contentType.includes('text/html')) {
                            responseType = 'html';
                            responseData = await response.text();
                            responseBodyContent.textContent = responseData;
                            responseBodyContent.classList.add('html-response');
                        } else if (contentType.includes('text/')) {
                            responseType = 'text';
                            responseData = await response.text();
                            responseBodyContent.textContent = responseData;
                            responseBodyContent.classList.remove('json-response', 'html-response');
                        } else if (contentType.includes('image/')) {
                            responseType = 'image';
                            responseBodyContent.textContent = '[图像内容] - 无法在文本视图中显示';
                            responseBodyContent.classList.remove('json-response', 'html-response');
                        } else {
                            responseData = await response.text();
                            responseBodyContent.textContent = responseData;
                            responseBodyContent.classList.remove('json-response', 'html-response');
                        }
                    } else {
                        container.querySelector('#responseContentType').textContent = '内容类型: 未知';
                        responseData = await response.text();
                        responseBodyContent.textContent = responseData;
                        responseBodyContent.classList.remove('json-response', 'html-response');
                    }

                    // 设置响应头
                    const headersText = Array.from(response.headers.entries())
                        .map(([key, value]) => `${key}: ${value}`)
                        .join('\n');
                    responseHeadersContent.textContent = headersText;

                    // 设置请求信息
                    const requestHeadersText = Object.entries(headers)
                        .map(([key, value]) => `${key}: ${value}`)
                        .join('\n');

                    const requestBodyText = (() => {
                        if (method === 'GET') return '无请求体 (GET请求)';
                        if (!body) return '无请求体';

                        if (typeof body === 'string') {
                            try {
                                // 尝试格式化JSON字符串
                                const parsedJson = JSON.parse(body);
                                return JSON.stringify(parsedJson, null, 2);
                            } catch (e) {
                                // 不是JSON，直接返回原始字符串
                                return body;
                            }
                        } else if (body instanceof FormData) {
                            // FormData不能直接查看，返回提示信息
                            return '[FormData: 表单数据]';
                        }

                        return '无法显示请求体';
                    })();

                    const requestInfoText =
                        `输入URL: ${inputUrl}
实际请求URL: ${actualUrl}
请求方法: ${method}
HTTP版本: HTTP/1.1

请求标头:
${requestHeadersText || '无自定义请求头'}

请求体:
${requestBodyText}`;

                    container.querySelector('#requestInfoContent').textContent = requestInfoText;

                } catch (error) {
                    // 显示错误
                    responseStatus.textContent = '请求失败';
                    responseStatus.className = 'response-status error';
                    responseBodyContent.textContent = `Error: ${error.message}`;
                    responseHeadersContent.textContent = '请求失败，无法获取响应头';

                    // 计算请求时间
                    const endTime = Date.now();
                    const timeTaken = endTime - startTime;
                    responseTime.textContent = `${timeTaken}ms`;

                    // 即使失败也展示请求信息
                    const requestHeadersText = Object.entries(headers)
                        .map(([key, value]) => `${key}: ${value}`)
                        .join('\n');

                    let requestBodyText = '无请求体';
                    if (method === 'POST' && body) {
                        if (typeof body === 'string') {
                            try {
                                const parsedJson = JSON.parse(body);
                                requestBodyText = JSON.stringify(parsedJson, null, 2);
                            } catch (e) {
                                requestBodyText = body;
                            }
                        } else if (body instanceof FormData) {
                            requestBodyText = '[FormData: 表单数据]';
                        }
                    }

                    // 获取尝试请求的URL
                    let attemptedUrl = inputUrl;
                    try {
                        // 如果我们创建了finalUrl，显示它
                        if (typeof finalUrl !== 'undefined' && finalUrl instanceof URL) {
                            attemptedUrl = finalUrl.toString();
                        }
                    } catch (e) {
                        // 如果出错，使用原始URL
                    }

                    const requestInfoText =
                        `输入URL: ${inputUrl}
尝试请求URL: ${attemptedUrl}
请求方法: ${method}
HTTP版本: HTTP/1.1

请求标头:
${requestHeadersText || '无自定义请求头'}

请求体:
${requestBodyText}

错误信息:
${error.message}`;

                    container.querySelector('#requestInfoContent').textContent = requestInfoText;
                }
            });
        } function wireCurrency(container) {
            const amountInput = container.querySelector('#amountInput');
            const fromCurrency = container.querySelector('#fromCurrency');
            const toCurrency = container.querySelector('#toCurrency');
            const resultInput = container.querySelector('#resultInput');
            const exchangeRateInfo = container.querySelector('#exchangeRateInfo');
            const convertBtn = container.querySelector('#convertBtn');
            const copyResultBtn = container.querySelector('#copyResultBtn');
            const swapBtn = container.querySelector('#swapBtn');
            const errorMsg = container.querySelector('#currencyError');
            const rateUpdateTime = container.querySelector('#rateUpdateTime');
            const currencyInfo = container.querySelector('.currency-info');

            // 先将info部分隐藏，等数据加载完成再显示
            if (currencyInfo) {
                currencyInfo.style.visibility = 'hidden';
                currencyInfo.style.position = 'absolute';
            }

            // 只允许输入数字和小数点
            amountInput.addEventListener('input', function (e) {
                this.value = this.value.replace(/[^\d.]/g, '');
                if (this.value.split('.').length > 2) {
                    this.value = this.value.replace(/\.+$/, '');
                }
            });

            // 模拟汇率数据 (实际应用中应该从API获取)
            const exchangeRates = {
                "CNY": { "USD": 0.1382, "EUR": 0.1276, "JPY": 20.50, "GBP": 0.1087, "KRW": 185.25, "HKD": 1.0815, "AUD": 0.2083 },
                "USD": { "CNY": 7.2352, "EUR": 0.9234, "JPY": 148.33, "GBP": 0.7866, "KRW": 1340.5, "HKD": 7.8265, "AUD": 1.5075 },
                "EUR": { "CNY": 7.8352, "USD": 1.0830, "JPY": 160.65, "GBP": 0.8518, "KRW": 1451.80, "HKD": 8.4732, "AUD": 1.6328 },
                "JPY": { "CNY": 0.0488, "USD": 0.00674, "EUR": 0.00622, "GBP": 0.00530, "KRW": 9.0356, "HKD": 0.05275, "AUD": 0.01016 },
                "GBP": { "CNY": 9.1997, "USD": 1.2712, "EUR": 1.1740, "JPY": 188.60, "KRW": 1703.28, "HKD": 9.9486, "AUD": 1.9164 },
                "KRW": { "CNY": 0.00540, "USD": 0.000746, "EUR": 0.000689, "JPY": 0.1107, "GBP": 0.000587, "HKD": 0.00584, "AUD": 0.00112 },
                "HKD": { "CNY": 0.9247, "USD": 0.1278, "EUR": 0.1180, "JPY": 18.953, "GBP": 0.1005, "KRW": 171.24, "AUD": 0.1926 },
                "AUD": { "CNY": 4.8002, "USD": 0.6633, "EUR": 0.6125, "JPY": 98.392, "GBP": 0.5218, "KRW": 889.21, "HKD": 5.1918 }
            };

            // 设置更新时间为当前时间
            const now = new Date();
            rateUpdateTime.textContent = now.toLocaleString('zh-CN');

            // 更新常用汇率显示（确保元素存在再更新）
            setTimeout(() => {
                const usdCny = document.getElementById('usd-cny');
                const eurCny = document.getElementById('eur-cny');
                const gbpCny = document.getElementById('gbp-cny');
                const cnyJpy = document.getElementById('cny-jpy');
                const cnyKrw = document.getElementById('cny-krw');
                const cnyHkd = document.getElementById('cny-hkd');

                if (usdCny) usdCny.textContent = exchangeRates['USD']['CNY'].toFixed(4);
                if (eurCny) eurCny.textContent = exchangeRates['EUR']['CNY'].toFixed(4);
                if (gbpCny) gbpCny.textContent = exchangeRates['GBP']['CNY'].toFixed(4);
                if (cnyJpy) cnyJpy.textContent = exchangeRates['CNY']['JPY'].toFixed(4);
                if (cnyKrw) cnyKrw.textContent = exchangeRates['CNY']['KRW'].toFixed(4);
                if (cnyHkd) cnyHkd.textContent = exchangeRates['CNY']['HKD'].toFixed(4);

                // 将汇率信息区域显示出来（如果还是隐藏的）
                const visibleCurrencyInfo = container.querySelector('.currency-info:not([style*="visibility: hidden"])');
                if (visibleCurrencyInfo) {
                    visibleCurrencyInfo.style.opacity = '1';
                    visibleCurrencyInfo.style.transform = 'translateY(0)';
                }
            }, 250);

            // 转换函数
            function convertCurrency() {
                const amount = parseFloat(amountInput.value.trim());
                const from = fromCurrency.value;
                const to = toCurrency.value;

                // 清除错误信息
                errorMsg.style.display = 'none';

                if (isNaN(amount)) {
                    errorMsg.textContent = '请输入有效的金额';
                    errorMsg.style.display = 'block';
                    return;
                }

                if (from === to) {
                    resultInput.value = amount.toFixed(2);
                    exchangeRateInfo.textContent = `1 ${from} = 1 ${to}`;
                    return;
                }

                const rate = exchangeRates[from][to];
                if (!rate) {
                    errorMsg.textContent = '无法获取汇率信息';
                    errorMsg.style.display = 'block';
                    return;
                }

                const result = amount * rate;
                resultInput.value = result.toFixed(2);
                exchangeRateInfo.textContent = `1 ${from} = ${rate.toFixed(4)} ${to}`;

                // 添加转换成功的视觉反馈
                resultInput.classList.add('highlight');
                setTimeout(() => {
                    resultInput.classList.remove('highlight');
                }, 700);
            }

            // 交换货币
            function swapCurrencies() {
                const tempCurrency = fromCurrency.value;
                fromCurrency.value = toCurrency.value;
                toCurrency.value = tempCurrency;

                if (amountInput.value && resultInput.value) {
                    const tempAmount = amountInput.value;
                    amountInput.value = resultInput.value;
                    resultInput.value = '';
                    convertCurrency();
                }
            }

            // 复制结果
            function copyResult() {
                if (resultInput.value) {
                    copyText(resultInput.value);
                    toast('结果已复制');
                } else {
                    toast('没有可复制的结果', 'warning');
                }
            }

            // 添加事件监听器
            convertBtn.addEventListener('click', convertCurrency);
            copyResultBtn.addEventListener('click', copyResult);
            swapBtn.addEventListener('click', swapCurrencies);

            // 为了更好的用户体验，在数值输入后自动转换
            amountInput.addEventListener('input', debounce(convertCurrency, 500));
            fromCurrency.addEventListener('change', convertCurrency);
            toCurrency.addEventListener('change', convertCurrency);

            // 帮助函数：防抖
            function debounce(func, wait) {
                let timeout;
                return function (...args) {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), wait);
                };
            }

            // 样式增强
            container.querySelector('.currency-input').style.transition = 'all 0.3s ease';

            // 准备汇率容器并添加高度锁定以防止抖动
            const currencyContainer = container.querySelector('.currency-container');
            currencyContainer.style.minHeight = '550px'; // 给容器一个最小高度，防止布局抖动

            // 更好的方式处理汇率信息区域，不复制DOM节点
            setTimeout(() => {
                const currencyInfo = container.querySelector('.currency-info');
                const placeholder = container.querySelector('.currency-info-placeholder');

                if (currencyInfo) {
                    // 直接修改现有的汇率信息区域，而不是复制和替换
                    currencyInfo.style.visibility = 'visible';
                    currencyInfo.style.position = 'static';
                    currencyInfo.style.opacity = '1';
                    currencyInfo.style.transform = 'none';
                    currencyInfo.style.display = 'block';

                    // 隐藏占位符而不是替换它
                    if (placeholder) {
                        placeholder.style.display = 'none';
                    }
                }
            }, 100);            // 添加高亮样式
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                
                /* 添加特殊动画处理视图切换 - 不使用垂直移动动画，只使用淡入效果 */
                @keyframes resetPosition {
                    0% { opacity: 0; }
                    100% { opacity: 1; }
                }
                
                .highlight {
                    background-color: rgba(16, 185, 129, 0.1) !important;
                    border-color: #10b981 !important;
                    transition: all 0.3s ease;
                }
                
                .currency-input:focus {
                    border-color: #3b82f6 !important;
                    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2) !important;
                }
            `;
            document.head.appendChild(style);
        }

        function wireCrypto(container) {
            // Tab 切换
            const tabs = container.querySelectorAll('.crypto-tab');
            const panels = container.querySelectorAll('.crypto-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.getAttribute('data-tab');
                    tabs.forEach(t => t.classList.remove('active'));
                    panels.forEach(p => p.classList.remove('active'));
                    tab.classList.add('active');
                    container.querySelector(`[data-panel="${target}"]`).classList.add('active');
                });
            });

            // MD5 哈希
            const md5Input = container.querySelector('#md5Input');
            const md5Output32Lower = container.querySelector('#md5Output32Lower');
            const md5Output32Upper = container.querySelector('#md5Output32Upper');
            const md5Output16Lower = container.querySelector('#md5Output16Lower');
            const md5Output16Upper = container.querySelector('#md5Output16Upper');
            const md5Error = container.querySelector('#md5Error');

            container.querySelector('#md5Generate').addEventListener('click', () => {
                try {
                    const text = md5Input.value;
                    if (!text) {
                        md5Error.textContent = '请输入要计算MD5的文本';
                        md5Error.style.display = 'block';
                        return;
                    }
                    const hash32 = generateMD5(text);
                    const hash16 = hash32.substring(8, 24);

                    md5Output32Lower.value = hash32.toLowerCase();
                    md5Output32Upper.value = hash32.toUpperCase();
                    md5Output16Lower.value = hash16.toLowerCase();
                    md5Output16Upper.value = hash16.toUpperCase();
                    md5Error.style.display = 'none';
                } catch (e) {
                    md5Error.textContent = '生成失败：' + e.message;
                    md5Error.style.display = 'block';
                }
            });

            container.querySelector('#md5Clear').addEventListener('click', () => {
                md5Input.value = '';
                md5Output32Lower.value = '';
                md5Output32Upper.value = '';
                md5Output16Lower.value = '';
                md5Output16Upper.value = '';
                md5Error.style.display = 'none';
            });

            container.querySelector('#md5Copy32Lower').addEventListener('click', () => {
                const text = md5Output32Lower.value;
                if (text) {
                    copyText(text);
                } else {
                    toast('无内容可复制');
                }
            });

            container.querySelector('#md5Copy32Upper').addEventListener('click', () => {
                const text = md5Output32Upper.value;
                if (text) {
                    copyText(text);
                } else {
                    toast('无内容可复制');
                }
            });

            container.querySelector('#md5Copy16Lower').addEventListener('click', () => {
                const text = md5Output16Lower.value;
                if (text) {
                    copyText(text);
                } else {
                    toast('无内容可复制');
                }
            });

            container.querySelector('#md5Copy16Upper').addEventListener('click', () => {
                const text = md5Output16Upper.value;
                if (text) {
                    copyText(text);
                } else {
                    toast('无内容可复制');
                }
            });

            // AES 加解密
            const aesInput = container.querySelector('#aesInput');
            const aesOutput = container.querySelector('#aesOutput');
            const aesKey = container.querySelector('#aesKey');
            const aesError = container.querySelector('#aesError');

            container.querySelector('#aesEncrypt').addEventListener('click', () => {
                try {
                    const text = aesInput.value;
                    const key = aesKey.value;
                    if (!text || !key) {
                        aesError.textContent = '请输入文本和密钥';
                        aesError.style.display = 'block';
                        return;
                    }
                    // 简单的AES加密模拟 (实际项目中应使用专业的加密库)
                    const encrypted = btoa(simpleEncrypt(text, key));
                    aesOutput.value = encrypted;
                    aesError.style.display = 'none';
                } catch (e) {
                    aesError.textContent = '加密失败：' + e.message;
                    aesError.style.display = 'block';
                }
            });

            container.querySelector('#aesDecrypt').addEventListener('click', () => {
                try {
                    const text = aesInput.value;
                    const key = aesKey.value;
                    if (!text || !key) {
                        aesError.textContent = '请输入文本和密钥';
                        aesError.style.display = 'block';
                        return;
                    }
                    // 简单的AES解密模拟
                    const decrypted = simpleDecrypt(atob(text), key);
                    aesOutput.value = decrypted;
                    aesError.style.display = 'none';
                } catch (e) {
                    aesError.textContent = '解密失败：' + e.message;
                    aesError.style.display = 'block';
                }
            });

            container.querySelector('#aesClear').addEventListener('click', () => {
                aesInput.value = '';
                aesOutput.value = '';
                aesKey.value = '';
                aesError.style.display = 'none';
            });

            container.querySelector('#aesCopy').addEventListener('click', () => {
                const text = aesOutput.value;
                if (text) {
                    copyText(text);
                } else {
                    toast('无内容可复制');
                }
            });

            // DES 加解密
            const desInput = container.querySelector('#desInput');
            const desOutput = container.querySelector('#desOutput');
            const desKey = container.querySelector('#desKey');
            const desError = container.querySelector('#desError');

            container.querySelector('#desEncrypt').addEventListener('click', () => {
                try {
                    const text = desInput.value;
                    const key = desKey.value;
                    if (!text || !key) {
                        desError.textContent = '请输入文本和密钥';
                        desError.style.display = 'block';
                        return;
                    }
                    if (key.length !== 8) {
                        desError.textContent = 'DES密钥必须是8个字符';
                        desError.style.display = 'block';
                        return;
                    }
                    // 简单的DES加密模拟
                    const encrypted = btoa(simpleEncrypt(text, key));
                    desOutput.value = encrypted;
                    desError.style.display = 'none';
                } catch (e) {
                    desError.textContent = '加密失败：' + e.message;
                    desError.style.display = 'block';
                }
            });

            container.querySelector('#desDecrypt').addEventListener('click', () => {
                try {
                    const text = desInput.value;
                    const key = desKey.value;
                    if (!text || !key) {
                        desError.textContent = '请输入文本和密钥';
                        desError.style.display = 'block';
                        return;
                    }
                    if (key.length !== 8) {
                        desError.textContent = 'DES密钥必须是8个字符';
                        desError.style.display = 'block';
                        return;
                    }
                    // 简单的DES解密模拟
                    const decrypted = simpleDecrypt(atob(text), key);
                    desOutput.value = decrypted;
                    desError.style.display = 'none';
                } catch (e) {
                    desError.textContent = '解密失败：' + e.message;
                    desError.style.display = 'block';
                }
            });

            container.querySelector('#desClear').addEventListener('click', () => {
                desInput.value = '';
                desOutput.value = '';
                desKey.value = '';
                desError.style.display = 'none';
            });

            container.querySelector('#desCopy').addEventListener('click', () => {
                const text = desOutput.value;
                if (text) {
                    copyText(text);
                } else {
                    toast('无内容可复制');
                }
            });
        }

        // MD5哈希函数 (简化版，用于演示)
        function generateMD5(str) {
            // 简化的MD5实现，生成32位十六进制字符串
            let hash = 0x67452301;
            let hash2 = 0xEFCDAB89;
            let hash3 = 0x98BADCFE;
            let hash4 = 0x10325476;

            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
                hash2 = ((hash2 << 7) - hash2) + char * 3;
                hash2 = hash2 & hash2;
                hash3 = ((hash3 << 11) - hash3) + char * 7;
                hash3 = hash3 & hash3;
                hash4 = ((hash4 << 13) - hash4) + char * 11;
                hash4 = hash4 & hash4;
            }

            const result = Math.abs(hash).toString(16).padStart(8, '0') +
                Math.abs(hash2).toString(16).padStart(8, '0') +
                Math.abs(hash3).toString(16).padStart(8, '0') +
                Math.abs(hash4).toString(16).padStart(8, '0');
            return result.substring(0, 32);
        }

        // 简单的加密函数 (仅用于演示)
        function simpleEncrypt(text, key) {
            let result = '';
            for (let i = 0; i < text.length; i++) {
                const textChar = text.charCodeAt(i);
                const keyChar = key.charCodeAt(i % key.length);
                result += String.fromCharCode(textChar ^ keyChar);
            }
            return result;
        }

        // 简单的解密函数 (仅用于演示)
        function simpleDecrypt(text, key) {
            return simpleEncrypt(text, key); // XOR加密解密是同一个操作
        }

        function wireTimeCopy(container) {
            container.querySelectorAll('.copy-btn').forEach(btn => {
                const targetId = btn.getAttribute('data-target');
                if (targetId) {
                    btn.addEventListener('click', () => {
                        const el = container.querySelector('#' + targetId);
                        const val = el?.textContent || '';
                        if (val) copyText(val);
                    });
                    return;
                }
                const direct = btn.getAttribute('data-copy');
                if (direct !== null) {
                    btn.addEventListener('click', () => copyText(direct));
                }
            });
            const tsCopyBtn = container.querySelector('#tsCopyBtn');
            const dtCopyBtn = container.querySelector('#dtCopyBtn');
            tsCopyBtn && tsCopyBtn.addEventListener('click', () => {
                const val = container.querySelector('#tsConvOut')?.textContent || '';
                if (val) copyText(val);
            });
            dtCopyBtn && dtCopyBtn.addEventListener('click', () => {
                const val = container.querySelector('#dtConvOut')?.textContent || '';
                if (val) copyText(val);
            });
        }
        function wireTimeConverters(container) {
            const tsInput = container.querySelector('#tsInput');
            const tsOut = container.querySelector('#tsConvOut');
            const dtY = container.querySelector('#dtY');
            const dtM = container.querySelector('#dtM');
            const dtD = container.querySelector('#dtD');
            const dtH = container.querySelector('#dtH');
            const dtMin = container.querySelector('#dtMin');
            const dtS = container.querySelector('#dtS');
            const dtOut = container.querySelector('#dtConvOut');

            function tsToDatetime() {
                if (!tsInput || !tsOut) return;
                let raw = (tsInput.value || '').trim();
                if (!raw) { tsOut.textContent = ''; return; }
                if (!/^\d+$/.test(raw)) { tsOut.textContent = '格式错误'; return; }
                let num = Number(raw);
                if (raw.length <= 10) num = num * 1000;
                const d = new Date(num);
                if (isNaN(d.getTime())) { tsOut.textContent = '无效时间戳'; return; }
                tsOut.textContent = fmtLocal(d);
            }
            function datetimeToTs() {
                if (!dtY || !dtM || !dtD || !dtH || !dtMin || !dtS || !dtOut) return;
                const y = Number((dtY.value || '').trim());
                const M = Number((dtM.value || '').trim());
                const d = Number((dtD.value || '').trim());
                const hh = Number((dtH.value || '').trim());
                const mm = Number((dtMin.value || '').trim());
                const ss = Number((dtS.value || '').trim());
                if (!y && !M && !d && !hh && !mm && !ss) { dtOut.textContent = ''; return; }
                if (!Number.isInteger(y) || !Number.isInteger(M) || !Number.isInteger(d) || !Number.isInteger(hh) || !Number.isInteger(mm) || !Number.isInteger(ss)) { dtOut.textContent = '格式错误'; return; }
                if (M < 1 || M > 12 || d < 1 || d > 31 || hh < 0 || hh > 23 || mm < 0 || mm > 59 || ss < 0 || ss > 59) { dtOut.textContent = '范围错误'; return; }
                const date = new Date(y, M - 1, d, hh, mm, ss);
                if (isNaN(date.getTime())) { dtOut.textContent = '无效日期'; return; }
                dtOut.textContent = String(Math.floor(date.getTime() / 1000));
            }
            tsInput && tsInput.addEventListener('input', tsToDatetime);
            [dtY, dtM, dtD, dtH, dtMin, dtS].forEach(inp => { inp && inp.addEventListener('input', datetimeToTs); });
        }
        // 统一的时间刷新计时器
        let timeTimer = null; let timePrevSec = null;
        function ensureTime() {
            let tv = document.querySelector('div.time-view[data-key="time"]');
            if (!tv) {
                tv = document.createElement('div');
                tv.className = 'time-view';
                tv.dataset.key = 'time';
                document.querySelector('main').appendChild(tv);
            }
            // 初次渲染
            tv.innerHTML = buildTimeHTML(new Date());
            wireTimeCopy(tv);
            wireTimeConverters(tv);
            return tv;
        }

        // 计时器在 ensureTime 区域声明

        // 统计相关函数已移除

        function ensureFrame(site) {
            let fr = document.querySelector(`iframe.site-frame[data-key="${site.key}"]`);
            if (!fr) {
                fr = document.createElement('iframe');
                fr.className = 'site-frame';
                fr.dataset.key = site.key;
                fr.referrerPolicy = 'no-referrer';
                fr.loading = 'eager';
                fr.setAttribute('allow', 'clipboard-read; clipboard-write; microphone; camera; geolocation; display-capture');
                fr.addEventListener('load', () => { if (site.key === current) hideStatus(); });
                fr.addEventListener('error', () => { if (site.key === current) showStatus('加载失败', 'error'); });
                fr.src = site.url;
                document.querySelector('main').appendChild(fr);
            }
            return fr;
        }


        const webviewKeys = new Set(['openai', 'grok', 'claude', 'qianwen', 'doubao']);

        function ensureWebview(site) {
            let wv = document.querySelector(`webview.site-view[data-key="${site.key}"]`);
            if (!wv) {
                wv = document.createElement('webview');
                wv.className = 'site-view';
                wv.dataset.key = site.key;
                wv.setAttribute('src', site.url);
                wv.setAttribute('partition', site.partition || `persist:${site.key}`);
                wv.setAttribute('allowpopups', 'true');
                wv.addEventListener('did-start-loading', () => { if (site.key === current) showStatus('加载中...'); });
                wv.addEventListener('did-finish-load', () => { if (site.key === current) hideStatus(); });
                wv.addEventListener('did-fail-load', (e) => { if (site.key === current) showStatus('加载失败 ' + e.errorCode, 'error'); });
                document.querySelector('main').appendChild(wv);
            }
            return wv;
        }

        // 独立窗口按钮逻辑移除

        function switchSite(key) {
            if (current === key) return;
            current = key;
            document.querySelectorAll('iframe.site-frame, webview.site-view, div.time-view, div.pwd-view, div.text-view, div.calc-view, div.dns-view, div.json-view, div.codec-view, div.crypto-view, div.currency-view, div.curl-view').forEach(el => {
                const isActive = el.dataset.key === key;
                el.classList.toggle('active', isActive);
                // 确保非活动视图隐藏，活动视图显示
                el.style.display = isActive ? 'flex' : 'none';
            });
            const site = sites.find(s => s.key === key);
            if (!site) return;
            let el;
            if (site.key === 'time') {
                el = ensureTime();
                // 开始刷新：大时钟与秒按秒刷新，毫秒更频繁刷新
                if (timeTimer) clearInterval(timeTimer);
                timeTimer = setInterval(() => {
                    const container = document.querySelector('div.time-view[data-key="time"]');
                    if (!container) return;
                    const now = new Date();
                    const msNow = now.getTime();
                    const secNow = Math.floor(msNow / 1000);
                    // 仅在秒变更时更新大时钟和秒值
                    if (timePrevSec !== secNow) {
                        timePrevSec = secNow;
                        const y = now.getFullYear();
                        const M = two(now.getMonth() + 1);
                        const d = two(now.getDate());
                        const hh = two(now.getHours());
                        const mm = two(now.getMinutes());
                        const ss = two(now.getSeconds());
                        const big = container.querySelector('.time-big');
                        if (big) {
                            big.innerHTML = `
                                <span class="year">${y}</span><span class="divider">-</span><span class="month">${M}</span><span class="divider">-</span><span class="day">${d}</span>
                                <span class="divider"> </span>
                                <span class="hour">${hh}</span><span class="divider">:</span><span class="minute">${mm}</span><span class="divider">:</span><span class="second">${ss}</span>
                            `;
                        }
                        const secEl = container.querySelector('#unixSecVal');
                        if (secEl) secEl.textContent = String(secNow);
                    }
                    // 毫秒更细刷新
                    const msEl = container.querySelector('#unixMsVal');
                    if (msEl) msEl.textContent = String(msNow);
                }, 200);
            } else if (site.key === 'pwd') {
                if (timeTimer) { clearInterval(timeTimer); timeTimer = null; timePrevSec = null; }
                el = ensurePwd();
            } else if (site.key === 'text') {
                if (timeTimer) { clearInterval(timeTimer); timeTimer = null; timePrevSec = null; }
                el = ensureText();
            } else if (site.key === 'calc') {
                if (timeTimer) { clearInterval(timeTimer); timeTimer = null; timePrevSec = null; }
                el = ensureCalc();
            } else if (site.key === 'dns') {
                if (timeTimer) { clearInterval(timeTimer); timeTimer = null; timePrevSec = null; }
                el = ensureDns();
            } else if (site.key === 'json') {
                if (timeTimer) { clearInterval(timeTimer); timeTimer = null; timePrevSec = null; }
                el = ensureJson();
            } else if (site.key === 'codec') {
                if (timeTimer) { clearInterval(timeTimer); timeTimer = null; timePrevSec = null; }
                el = ensureCodec();
            } else if (site.key === 'crypto') {
                if (timeTimer) { clearInterval(timeTimer); timeTimer = null; timePrevSec = null; }
                el = ensureCrypto();
            } else if (site.key === 'currency') {
                if (timeTimer) { clearInterval(timeTimer); timeTimer = null; timePrevSec = null; }

                // 保存滚动位置，避免闪烁
                document.body.style.overflow = 'hidden';

                // 在切换到货币视图之前删除任何现有的货币视图，以确保我们是从头开始的
                const existingView = document.querySelector('div.currency-view[data-key="currency"]');
                if (existingView && existingView.parentNode) {
                    existingView.parentNode.removeChild(existingView);
                }

                // 创建全新的货币视图
                el = ensureCurrency();

                // 恢复滚动
                setTimeout(() => {
                    document.body.style.overflow = '';
                }, 50);
            } else if (site.key === 'curl') {
                if (timeTimer) { clearInterval(timeTimer); timeTimer = null; timePrevSec = null; }
                el = ensureCurl();
            } else {
                // 非时间页则停止计时器
                if (timeTimer) { clearInterval(timeTimer); timeTimer = null; timePrevSec = null; }
                el = webviewKeys.has(site.key) ? ensureWebview(site) : ensureFrame(site);
            }
            el.classList.add('active');
            el.style.display = 'flex'; // 确保当前活动视图是显示的
            renderList();
            if (site.key === 'time' || site.key === 'pwd' || site.key === 'text' || site.key === 'calc' || site.key === 'dns' || site.key === 'json' || site.key === 'codec' || site.key === 'crypto' || site.key === 'currency' || site.key === 'curl') { hideStatus(); } else { showStatus('加载中...'); }
            window.llmHub?.persistLastSite?.(key);
            // 独立窗口按钮逻辑已移除
        }

        function init() {
            // 在init中添加货币转换工具，紧邻在加解密工具后面
            const cryptoIndex = sites.findIndex(s => s.key === 'crypto');
            if (cryptoIndex !== -1) {
                // 先移除可能已存在的货币转换工具
                const currencyIndex = sites.findIndex(s => s.key === 'currency');
                if (currencyIndex !== -1) {
                    sites.splice(currencyIndex, 1);
                }
                // 先移除可能已存在的curl工具
                const curlIndex = sites.findIndex(s => s.key === 'curl');
                if (curlIndex !== -1) {
                    sites.splice(curlIndex, 1);
                }
                // 在加解密工具后面插入货币转换工具和curl工具
                sites.splice(cryptoIndex + 1, 0, { key: 'currency', title: '货币转换' });
                sites.splice(cryptoIndex + 2, 0, { key: 'curl', title: 'CURL工具' });
            } else {
                // 如果找不到加解密工具，就添加到末尾
                if (!sites.find(s => s.key === 'currency')) {
                    sites.push({ key: 'currency', title: '货币转换' });
                }
                if (!sites.find(s => s.key === 'curl')) {
                    sites.push({ key: 'curl', title: 'CURL工具' });
                }
            }

            // 确保currency工具已被添加到moduleVisibility中
            if (moduleVisibility['currency'] === undefined) {
                moduleVisibility['currency'] = true; // 默认可见
            }

            // 为每个站点初始化可见性设置（如果不存在）
            sites.forEach(site => {
                if (moduleVisibility[site.key] === undefined) {
                    moduleVisibility[site.key] = true; // 默认可见
                }
            });

            renderList();
            const first = window.llmHub?.lastSite || sites[0]?.key;
            if (first) switchSite(first);
        }

        // 等待DOM和preload脚本都加载完成
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                // 延迟初始化，确保preload脚本完全加载
                setTimeout(init, 200);
            });
        } else {
            setTimeout(init, 200);
        }

        // 设置面板相关功能
        function renderSettingsPanel() {
            modulesList.innerHTML = '';

            // 显示所有工具，包括货币转换工具
            sites.forEach(site => {
                const checked = moduleVisibility[site.key] !== false;
                const moduleRow = document.createElement('div');
                moduleRow.style.display = 'flex';
                moduleRow.style.alignItems = 'center';
                moduleRow.style.gap = '8px';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `module-${site.key}`;
                checkbox.checked = checked;
                checkbox.style.cursor = 'pointer';

                const label = document.createElement('label');
                label.htmlFor = `module-${site.key}`;
                label.textContent = site.title;
                label.style.cursor = 'pointer';
                label.style.color = '#e5e7eb';

                moduleRow.appendChild(checkbox);
                moduleRow.appendChild(label);
                modulesList.appendChild(moduleRow);
            });
        }

        function saveModuleSettings() {
            sites.forEach(site => {
                const checkbox = document.getElementById(`module-${site.key}`);
                if (checkbox) {
                    moduleVisibility[site.key] = checkbox.checked;
                }
            });

            localStorage.setItem('moduleVisibility', JSON.stringify(moduleVisibility));
            renderList();
            settingsPanel.style.display = 'none';
            toast('设置已保存');
        }

        // 设置面板交互
        btnSettings?.addEventListener('click', (e) => {
            // 确保事件不被其他元素捕获
            e.stopPropagation();

            // 显示/隐藏设置面板
            const isVisible = settingsPanel.style.display === 'block';
            settingsPanel.style.display = isVisible ? 'none' : 'block';

            if (!isVisible) {
                renderSettingsPanel();
            }
        });

        // 保存按钮点击事件
        settingsSave?.addEventListener('click', saveModuleSettings);

        // 点击其他区域关闭面板
        document.addEventListener('click', (e) => {
            if (settingsPanel.style.display === 'block' &&
                !settingsPanel.contains(e.target) &&
                e.target !== btnSettings) {
                settingsPanel.style.display = 'none';
            }
        });

        // 调试：检查window对象
        setTimeout(() => {
            console.log('window.llmHub:', window.llmHub);
        }, 500);
    </script>
</body>

</html>